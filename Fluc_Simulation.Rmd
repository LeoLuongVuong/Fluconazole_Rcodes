---
title: "Fluc_Simulation"
author: "Leo"
date: "2023-05-02"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r call necessary packages}
library(tidyr)
library(knitr)
library(ggplot2)
library(dplyr)
library(xpose4)
library(vpc)
library(tidyverse)
library(readxl)
library(glmulti)
library(nlme)
library(ggpubr)
library(data.table)
library(mefa)
library(binom)
library(nlme)
library(pROC)
library(binom)
library(ggpubr)
library(truncnorm)

```

## General simulation strategy

### Calculate the followings
### 1 per each simulated dataset, calculate PTA of Cmin & AUC24h per day per FFM
#### 1.1. Note: each dataset has 13 different FFM, each is simulated 1000 times
#### 1.2. Do so for each of the regimen
### 2. Then simulated PTA of Cmin and AUC24h throughout 14days of treatment of different dataset

### For standard dosing regimen

```{r standard dosing regimen CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")

# Read in sdtab_stand.csv file
standard_dosing <- read.csv("sdtab_stand.csv")

#change all the variables to numeric
standard_dosing[] <- lapply(standard_dosing, as.numeric)

#eliminate all NAs
standard_dosing <- na.omit(standard_dosing)

# Extract only the trough events
standard_dosing_trough <- standard_dosing[standard_dosing$TROUGH == 1,]

# Create a new variable AUC24 for each ID
standard_dosing_trough <- standard_dosing_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
standard_dosing_trough<- standard_dosing_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Extract ID, DV, AUC24, DAY, and FFM columns
PTA_std <- subset(standard_dosing_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))

# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_std$PTA_Cmin_15 <- 100 * ave(PTA_std$DV >= 15, PTA_std$DAY, PTA_std$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_std$PTA_Cmin_75 <- 100 * ave(PTA_std$DV >= 7.5, PTA_std$DAY, PTA_std$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_std$PTA_Cmin_80 <- 100 * ave(PTA_std$DV >= 80, PTA_std$DAY, PTA_std$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_std$PTA_AUC24_400 <- 100 * ave(PTA_std$AUC24 >= 400, PTA_std$DAY, PTA_std$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_std$PTA_AUC24_200 <- 100 * ave(PTA_std$AUC24 >= 200, PTA_std$DAY, PTA_std$FFM, FUN = mean)

# Create PTA_std_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_std_overall <- unique(PTA_std[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])

```

```{r standard dosing regimen non-CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")

# Read in sdtab_stand_noCRRT.csv file
standard_dosing_noCRRT <- read.csv("sdtab_stand_noCRRT.csv")

# Change all the variables to numeric
standard_dosing_noCRRT[] <- lapply(standard_dosing_noCRRT, as.numeric)

# Eliminate all NAs
standard_dosing_noCRRT <- na.omit(standard_dosing_noCRRT)

# Extract only the trough events
standard_dosing_trough_noCRRT <- standard_dosing_noCRRT[standard_dosing_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
standard_dosing_trough_noCRRT <- standard_dosing_trough_noCRRT %>% 
  group_by(ID) %>% 
  mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% 
  ungroup() %>% 
  mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))

# Extract ID, DV, AUC24, DAY, and FFM columns
PTA_std_noCRRT <- subset(standard_dosing_trough_noCRRT, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))

# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_std_noCRRT$PTA_Cmin_15 <- 100 * ave(PTA_std_noCRRT$DV >= 15, PTA_std_noCRRT$DAY, PTA_std_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_std_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_std_noCRRT$DV >= 7.5, PTA_std_noCRRT$DAY, PTA_std_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_std_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_std_noCRRT$DV >= 80, PTA_std_noCRRT$DAY, PTA_std_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_std_noCRRT$PTA_AUC24_400 <- 100 * ave(PTA_std_noCRRT$AUC24 >= 400, PTA_std_noCRRT$DAY, PTA_std_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_std_noCRRT$PTA_AUC24_200 <- 100 * ave(PTA_std_noCRRT$AUC24 >= 200, PTA_std_noCRRT$DAY, PTA_std_noCRRT$FFM, FUN = mean)

# Create PTA_std_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_std_noCRRT_overall <- unique(PTA_std_noCRRT[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])
```

### For dosing regimen 01

```{r dosing regimen 01 CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_01 <- read.csv("sdtab_01.csv")
sdtab_01[] <- lapply(sdtab_01, as.numeric)
sdtab_01 <- na.omit(sdtab_01)
sdtab_01_trough <- sdtab_01[sdtab_01$TROUGH == 1,]
sdtab_01_trough <- sdtab_01_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_01_trough <- sdtab_01_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_01 <- subset(sdtab_01_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_01$PTA_Cmin_15 <- 100 * ave(PTA_01$DV >= 15, PTA_01$DAY, PTA_01$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_01$PTA_Cmin_75 <- 100 * ave(PTA_01$DV >= 7.5, PTA_01$DAY, PTA_01$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_01$PTA_Cmin_80 <- 100 * ave(PTA_01$DV >= 80, PTA_01$DAY, PTA_01$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_01$PTA_AUC24_400 <- 100 * ave(PTA_01$AUC24 >= 400, PTA_01$DAY, PTA_01$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_01$PTA_AUC24_200 <- 100 * ave(PTA_01$AUC24 >= 200, PTA_01$DAY, PTA_01$FFM, FUN = mean)

# Create PTA_01_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_01_overall <- unique(PTA_01[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])

```

```{r dosing regimen 01 non-CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_01_noCRRT <- read.csv("sdtab_01_noCRRT.csv")
sdtab_01_noCRRT[] <- lapply(sdtab_01_noCRRT, as.numeric)
sdtab_01_noCRRT <- na.omit(sdtab_01_noCRRT)
sdtab_01_noCRRT_trough <- sdtab_01_noCRRT[sdtab_01_noCRRT$TROUGH == 1,]
sdtab_01_noCRRT_trough <- sdtab_01_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_01_noCRRT_trough <- sdtab_01_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_01_noCRRT <- subset(sdtab_01_noCRRT_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_01_noCRRT$PTA_Cmin_15 <- 100 * ave(PTA_01_noCRRT$DV >= 15, PTA_01_noCRRT$DAY, PTA_01_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_01_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_01_noCRRT$DV >= 7.5, PTA_01_noCRRT$DAY, PTA_01_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_01_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_01_noCRRT$DV >= 80, PTA_01_noCRRT$DAY, PTA_01_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_01_noCRRT$PTA_AUC24_400 <- 100 * ave(PTA_01_noCRRT$AUC24 >= 400, PTA_01_noCRRT$DAY, PTA_01_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_01_noCRRT$PTA_AUC24_200 <- 100 * ave(PTA_01_noCRRT$AUC24 >= 200, PTA_01_noCRRT$DAY, PTA_01_noCRRT$FFM, FUN = mean)

# Create PTA_01_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_01_noCRRT_overall <- unique(PTA_01_noCRRT[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])
```

### For dosing regimen 02

```{r dosing regimen 02 CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_02 <- read.csv("sdtab_02.csv")
sdtab_02[] <- lapply(sdtab_02, as.numeric)
sdtab_02 <- na.omit(sdtab_02)
sdtab_02_trough <- sdtab_02[sdtab_02$TROUGH == 1,]
sdtab_02_trough <- sdtab_02_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_02_trough <- sdtab_02_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_02 <- subset(sdtab_02_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_02$PTA_Cmin_15 <- 100 * ave(PTA_02$DV >= 15, PTA_02$DAY, PTA_02$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_02$PTA_Cmin_75 <- 100 * ave(PTA_02$DV >= 7.5, PTA_02$DAY, PTA_02$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_02$PTA_Cmin_80 <- 100 * ave(PTA_02$DV >= 80, PTA_02$DAY, PTA_02$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_02$PTA_AUC24_400 <- 100 * ave(PTA_02$AUC24 >= 400, PTA_02$DAY, PTA_02$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_02$PTA_AUC24_200 <- 100 * ave(PTA_02$AUC24 >= 200, PTA_02$DAY, PTA_02$FFM, FUN = mean)

# Create PTA_02_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_02_overall <- unique(PTA_02[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])

```

```{r dosing regimen 02 non-CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_02_noCRRT <- read.csv("sdtab_02_noCRRT.csv")
sdtab_02_noCRRT[] <- lapply(sdtab_02_noCRRT, as.numeric)
sdtab_02_noCRRT <- na.omit(sdtab_02_noCRRT)
sdtab_02_noCRRT_trough <- sdtab_02_noCRRT[sdtab_02_noCRRT$TROUGH == 1,]
sdtab_02_noCRRT_trough <- sdtab_02_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_02_noCRRT_trough <- sdtab_02_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_02_noCRRT <- subset(sdtab_02_noCRRT_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_02_noCRRT$PTA_Cmin_15 <- 100 * ave(PTA_02_noCRRT$DV >= 15, PTA_02_noCRRT$DAY, PTA_02_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_02_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_02_noCRRT$DV >= 7.5, PTA_02_noCRRT$DAY, PTA_02_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_02_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_02_noCRRT$DV >= 80, PTA_02_noCRRT$DAY, PTA_02_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_02_noCRRT$PTA_AUC24_400 <- 100 * ave(PTA_02_noCRRT$AUC24 >= 400, PTA_02_noCRRT$DAY, PTA_02_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_02_noCRRT$PTA_AUC24_200 <- 100 * ave(PTA_02_noCRRT$AUC24 >= 200, PTA_02_noCRRT$DAY, PTA_02_noCRRT$FFM, FUN = mean)

# Create PTA_02_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_02_noCRRT_overall <- unique(PTA_02_noCRRT[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])
```

### For dosing regimen 03

```{r dosing regimen 03 CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_03 <- read.csv("sdtab_03.csv")
sdtab_03[] <- lapply(sdtab_03, as.numeric)
sdtab_03 <- na.omit(sdtab_03)
sdtab_03_trough <- sdtab_03[sdtab_03$TROUGH == 1,]
sdtab_03_trough <- sdtab_03_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_03_trough <- sdtab_03_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_03 <- subset(sdtab_03_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_03$PTA_Cmin_15 <- 100 * ave(PTA_03$DV >= 15, PTA_03$DAY, PTA_03$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_03$PTA_Cmin_75 <- 100 * ave(PTA_03$DV >= 7.5, PTA_03$DAY, PTA_03$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_03$PTA_Cmin_80 <- 100 * ave(PTA_03$DV >= 80, PTA_03$DAY, PTA_03$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_03$PTA_AUC24_400 <- 100 * ave(PTA_03$AUC24 >= 400, PTA_03$DAY, PTA_03$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_03$PTA_AUC24_200 <- 100 * ave(PTA_03$AUC24 >= 200, PTA_03$DAY, PTA_03$FFM, FUN = mean)

# Create PTA_03_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_03_overall <- unique(PTA_03[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])

```

```{r dosing regimen 03 non-CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_03_noCRRT <- read.csv("sdtab_03_noCRRT.csv")
sdtab_03_noCRRT[] <- lapply(sdtab_03_noCRRT, as.numeric)
sdtab_03_noCRRT <- na.omit(sdtab_03_noCRRT)
sdtab_03_noCRRT_trough <- sdtab_03_noCRRT[sdtab_03_noCRRT$TROUGH == 1,]
sdtab_03_noCRRT_trough <- sdtab_03_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_03_noCRRT_trough <- sdtab_03_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_03_noCRRT <- subset(sdtab_03_noCRRT_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_03_noCRRT$PTA_Cmin_15 <- 100 * ave(PTA_03_noCRRT$DV >= 15, PTA_03_noCRRT$DAY, PTA_03_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_03_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_03_noCRRT$DV >= 7.5, PTA_03_noCRRT$DAY, PTA_03_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_03_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_03_noCRRT$DV >= 80, PTA_03_noCRRT$DAY, PTA_03_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_03_noCRRT$PTA_AUC24_400 <- 100 * ave(PTA_03_noCRRT$AUC24 >= 400, PTA_03_noCRRT$DAY, PTA_03_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_03_noCRRT$PTA_AUC24_200 <- 100 * ave(PTA_03_noCRRT$AUC24 >= 200, PTA_03_noCRRT$DAY, PTA_03_noCRRT$FFM, FUN = mean)

# Create PTA_03_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_03_noCRRT_overall <- unique(PTA_03_noCRRT[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])
```

### For dosing regimen 04, this is a much bigger file, there fore I handle it differently

```{r dosing regimen 04 CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_04 <- read.table("sdtab_04.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)
sdtab_04[] <- lapply(sdtab_04, as.numeric)
sdtab_04 <- na.omit(sdtab_04)
sdtab_04_trough <- sdtab_04[sdtab_04$TROUGH == 1,]
sdtab_04_trough <- sdtab_04_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_04_trough <- sdtab_04_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_04 <- subset(sdtab_04_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_04$PTA_Cmin_15 <- 100 * ave(PTA_04$DV >= 15, PTA_04$DAY, PTA_04$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_04$PTA_Cmin_75 <- 100 * ave(PTA_04$DV >= 7.5, PTA_04$DAY, PTA_04$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_04$PTA_Cmin_80 <- 100 * ave(PTA_04$DV >= 80, PTA_04$DAY, PTA_04$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_04$PTA_AUC24_400 <- 100 * ave(PTA_04$AUC24 >= 400, PTA_04$DAY, PTA_04$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_04$PTA_AUC24_200 <- 100 * ave(PTA_04$AUC24 >= 200, PTA_04$DAY, PTA_04$FFM, FUN = mean)

# Create PTA_04_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_04_overall <- unique(PTA_04[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])

```

```{r dosing regimen 04 non-CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_04_noCRRT <- read.table("sdtab_04_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)
sdtab_04_noCRRT[] <- lapply(sdtab_04_noCRRT, as.numeric)
sdtab_04_noCRRT <- na.omit(sdtab_04_noCRRT)
sdtab_04_noCRRT_trough <- sdtab_04_noCRRT[sdtab_04_noCRRT$TROUGH == 1,]
sdtab_04_noCRRT_trough <- sdtab_04_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_04_noCRRT_trough <- sdtab_04_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_04_noCRRT <- subset(sdtab_04_noCRRT_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_04_noCRRT$PTA_Cmin_15 <- 100 * ave(PTA_04_noCRRT$DV >= 15, PTA_04_noCRRT$DAY, PTA_04_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_04_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_04_noCRRT$DV >= 7.5, PTA_04_noCRRT$DAY, PTA_04_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_04_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_04_noCRRT$DV >= 80, PTA_04_noCRRT$DAY, PTA_04_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_04_noCRRT$PTA_AUC24_400 <- 100 * ave(PTA_04_noCRRT$AUC24 >= 400, PTA_04_noCRRT$DAY, PTA_04_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_04_noCRRT$PTA_AUC24_200 <- 100 * ave(PTA_04_noCRRT$AUC24 >= 200, PTA_04_noCRRT$DAY, PTA_04_noCRRT$FFM, FUN = mean)

# Create PTA_04_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_04_noCRRT_overall <- unique(PTA_04_noCRRT[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])
```

### For dosing regimen 05

```{r dosing regimen 05 CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_05 <- read.csv("sdtab_05.csv")
sdtab_05[] <- lapply(sdtab_05, as.numeric)
sdtab_05 <- na.omit(sdtab_05)
sdtab_05_trough <- sdtab_05[sdtab_05$TROUGH == 1,]
sdtab_05_trough <- sdtab_05_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_05_trough <- sdtab_05_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_05 <- subset(sdtab_05_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_05$PTA_Cmin_15 <- 100 * ave(PTA_05$DV >= 15, PTA_05$DAY, PTA_05$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_05$PTA_Cmin_80 <- 100 * ave(PTA_05$DV >= 80, PTA_05$DAY, PTA_05$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_05$PTA_Cmin_75 <- 100 * ave(PTA_05$DV >= 7.5, PTA_05$DAY, PTA_05$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_05$PTA_AUC24_400 <- 100 * ave(PTA_05$AUC24 >= 400, PTA_05$DAY, PTA_05$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_05$PTA_AUC24_200 <- 100 * ave(PTA_05$AUC24 >= 200, PTA_05$DAY, PTA_05$FFM, FUN = mean)

# Create PTA_05_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_05_overall <- unique(PTA_05[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])

```

```{r dosing regimen 05 non-CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_05_noCRRT <- read.csv("sdtab_05_noCRRT.csv")
sdtab_05_noCRRT[] <- lapply(sdtab_05_noCRRT, as.numeric)
sdtab_05_noCRRT <- na.omit(sdtab_05_noCRRT)
sdtab_05_noCRRT_trough <- sdtab_05_noCRRT[sdtab_05_noCRRT$TROUGH == 1,]
sdtab_05_noCRRT_trough <- sdtab_05_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_05_noCRRT_trough <- sdtab_05_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_05_noCRRT <- subset(sdtab_05_noCRRT_trough, select = c("ID", "DV","CRRT", "AUC24", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_05_noCRRT$PTA_Cmin_15 <- 100 * ave(PTA_05_noCRRT$DV >= 15, PTA_05_noCRRT$DAY, PTA_05_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_05_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_05_noCRRT$DV >= 7.5, PTA_05_noCRRT$DAY, PTA_05_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_05_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_05_noCRRT$DV >= 80, PTA_05_noCRRT$DAY, PTA_05_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_05_noCRRT$PTA_AUC24_400 <- 100 * ave(PTA_05_noCRRT$AUC24 >= 400, PTA_05_noCRRT$DAY, PTA_05_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_05_noCRRT$PTA_AUC24_200 <- 100 * ave(PTA_05_noCRRT$AUC24 >= 200, PTA_05_noCRRT$DAY, PTA_05_noCRRT$FFM, FUN = mean)

# Create PTA_05_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_05_noCRRT_overall <- unique(PTA_05_noCRRT[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])
```

### For dosing regimen 06

```{r dosing regimen 06 CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_06 <- read.csv("sdtab_06.csv")
sdtab_06[] <- lapply(sdtab_06, as.numeric)
sdtab_06 <- na.omit(sdtab_06)
sdtab_06_trough <- sdtab_06[sdtab_06$TROUGH == 1,]
sdtab_06_trough <- sdtab_06_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_06_trough <- sdtab_06_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_06 <- subset(sdtab_06_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_06$PTA_Cmin_15 <- 100 * ave(PTA_06$DV >= 15, PTA_06$DAY, PTA_06$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_06$PTA_Cmin_75 <- 100 * ave(PTA_06$DV >= 7.5, PTA_06$DAY, PTA_06$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_06$PTA_Cmin_80 <- 100 * ave(PTA_06$DV >= 80, PTA_06$DAY, PTA_06$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_06$PTA_AUC24_400 <- 100 * ave(PTA_06$AUC24 >= 400, PTA_06$DAY, PTA_06$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_06$PTA_AUC24_200 <- 100 * ave(PTA_06$AUC24 >= 200, PTA_06$DAY, PTA_06$FFM, FUN = mean)

# Create PTA_06_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_06_overall <- unique(PTA_06[c("PTA_Cmin_15", "PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])

```

```{r dosing regimen 06 non-CRRT, warning=FALSE}
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation")
sdtab_06_noCRRT <- read.csv("sdtab_06_noCRRT.csv")
sdtab_06_noCRRT[] <- lapply(sdtab_06_noCRRT, as.numeric)
sdtab_06_noCRRT <- na.omit(sdtab_06_noCRRT)
sdtab_06_noCRRT_trough <- sdtab_06_noCRRT[sdtab_06_noCRRT$TROUGH == 1,]
sdtab_06_noCRRT_trough <- sdtab_06_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1])) %>% ungroup()
sdtab_06_noCRRT_trough <- sdtab_06_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2, AUC24))
PTA_06_noCRRT <- subset(sdtab_06_noCRRT_trough, select = c("ID", "DV", "AUC24","CRRT", "DAY", "FFM"))
# Calculate percentage of DV >= 15 per DAY per FFM (PTA_Cmin_15)
PTA_06_noCRRT$PTA_Cmin_15 <- 100 * ave(PTA_06_noCRRT$DV >= 15, PTA_06_noCRRT$DAY, PTA_06_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 7.5 per DAY per FFM (PTA_Cmin_75)
PTA_06_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_06_noCRRT$DV >= 7.5, PTA_06_noCRRT$DAY, PTA_06_noCRRT$FFM, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per FFM (PTA_Cmin_80)
PTA_06_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_06_noCRRT$DV >= 80, PTA_06_noCRRT$DAY, PTA_06_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 400 per DAY per FFM (PTA_AUC24_400)
PTA_06_noCRRT$PTA_AUC24_400 <- 100 * ave(PTA_06_noCRRT$AUC24 >= 400, PTA_06_noCRRT$DAY, PTA_06_noCRRT$FFM, FUN = mean)

# Calculate percentage of AUC24 >= 200 per DAY per FFM (PTA_AUC24_200)
PTA_06_noCRRT$PTA_AUC24_200 <- 100 * ave(PTA_06_noCRRT$AUC24 >= 200, PTA_06_noCRRT$DAY, PTA_06_noCRRT$FFM, FUN = mean)

# Create PTA_06_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_AUC24, DAY, and FFM
PTA_06_noCRRT_overall <- unique(PTA_06_noCRRT[c("PTA_Cmin_15","PTA_Cmin_75","PTA_Cmin_80","PTA_AUC24_400", "PTA_AUC24_200", "DAY", "FFM","CRRT")])
```

### Make a line plot of PTA vs FFM of all regimens

#### I will denote standard regimen as regimen number 1, and increases to 7 with dosing regimen no 6

```{r create a new dosing regimen column for all dataset}
PTA_std_overall$Regimen<-1
PTA_std_noCRRT_overall$Regimen<-1
PTA_01_overall$Regimen<-2
PTA_01_noCRRT_overall$Regimen<-2
PTA_02_overall$Regimen<-3
PTA_02_noCRRT_overall$Regimen<-3
PTA_03_overall$Regimen<-4
PTA_03_noCRRT_overall$Regimen<-4
PTA_04_overall$Regimen<-5
PTA_04_noCRRT_overall$Regimen<-5
PTA_05_overall$Regimen<-6
PTA_05_noCRRT_overall$Regimen<-6
PTA_06_overall$Regimen<-7
PTA_06_noCRRT_overall$Regimen<-7
```

```{r combine all of them into 1 single dataset used for plotting}
PTA_overall<-rbind(PTA_std_overall, PTA_std_noCRRT_overall, PTA_01_overall, PTA_01_noCRRT_overall, PTA_02_overall, PTA_02_noCRRT_overall, PTA_03_overall, PTA_03_noCRRT_overall,PTA_04_overall,PTA_04_noCRRT_overall, PTA_05_overall, PTA_05_noCRRT_overall, PTA_06_overall, PTA_06_noCRRT_overall)
PTA_overall$Regimen<-as.factor(PTA_overall$Regimen)
PTA_overall$CRRT<-as.factor(PTA_overall$CRRT)
```

#### Then I make line plots of PTA Cmin of 15 per day of all regimens 
##### Day 1
```{r PTA Cmin 15 mg/L day 1 CRRT patients}
library(ggplot2)
PTA_CRRT15_DAY1<-PTA_overall %>%
  filter(CRRT==1, DAY==1) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_15, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 40), breaks = seq(0, 40, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 15 mg/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h"))
PTA_CRRT15_DAY1
```
```{r PTA Cmin 15 mg/L day 1 CRRT patients 2nd option}
library(ggplot2)

PTA_CRRT15_DAY1<-PTA_overall %>% 
  filter(CRRT == 1, DAY == 1) %>% 
  ggplot(aes(x = FFM, y = PTA_Cmin_15, color = Regimen)) +
  geom_line(size = 1) +
  labs(title = "Probability of Cmin treatment target attainment vs. Fat Free Mass",
       x = "Fat Free Mass (kg)", y = "Probability of Cmin treatment target attainment",
       color = "Dosing regimen") +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5)) +
  scale_y_continuous(limits = c(0, 40), breaks = seq(0, 40, by = 5)) +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "right",
        axis.text = element_text(size = 12),
        legend.title = element_text(size = 12)) +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),
                     name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", 
                                "1000 mg q24h (day 1) / 600 mg q24h", 
                                "1000 mg q24h (day 1) / 800 mg q24h",
                                "1200 mg q24h (day 1) / 1000 mg q24h", 
                                "800 mg first 12h / 400 mg q12h", 
                                "12 mg/kg q24h (day 1) / 6 mg/kg q24h", 
                                "18 mg/kg q24h (day 1) / 12 mg/kg q24h"))
PTA_CRRT15_DAY1
```
```{r PTA Cmin 15 mg/L day 1 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT15_DAY1<-  ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 1,],aes(x = FFM, y = PTA_Cmin_15,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 90), breaks = seq(0, 90, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 15 mg/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h"))
PTA_NOCRRT15_DAY1
```
##### Day 2
```{r PTA Cmin 15 mg/L day 2 CRRT patients}
library(ggplot2)
PTA_CRRT15_DAY2<-PTA_overall %>%
  filter(CRRT==1, DAY==2) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_15, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 45), breaks = seq(0, 45, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 15 mg/L in CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h"))
PTA_CRRT15_DAY2
```

```{r PTA Cmin 15 mg/L day 2 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT15_DAY2<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 2,],aes(x = FFM, y = PTA_Cmin_15,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 95), breaks = seq(0, 95, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)" ,expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 15 mg/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
         geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT15_DAY2
```

##### Day 7
```{r PTA Cmin 15 mg/L day 7 CRRT patients}
library(ggplot2)
PTA_CRRT15_DAY7<-PTA_overall %>%
  filter(CRRT==1, DAY==7) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_15, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 70), breaks = seq(0, 70, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 15 mg/L in CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h"))
PTA_CRRT15_DAY7
```

```{r PTA Cmin 15 mg/L day 7 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT15_DAY7<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 7,],aes(x = FFM, y = PTA_Cmin_15,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)" ,expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 15 mg/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
         geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT15_DAY7
```

##### Day 14
```{r PTA Cmin 15 mg/L day 14 CRRT patients}
library(ggplot2)
PTA_CRRT15_DAY14<-PTA_overall %>%
  filter(CRRT==1, DAY==14) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_15, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 75), breaks = seq(0, 75, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 15 mg/L in CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h"))
PTA_CRRT15_DAY14
```

```{r PTA Cmin 15 mg/L day 14 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT15_DAY14<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 14,],aes(x = FFM, y = PTA_Cmin_15,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)" ,expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 15 mg/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT15_DAY14
```

#### Then I make line plots of PTA AUC of 400 per day of all regimens 
##### Day 1
```{r PTA AUC 400 mgxh/L day 1 CRRT patients}
library(ggplot2)
PTA_CRRT400_DAY1<-PTA_overall %>%
  filter(CRRT==1, DAY==1) %>%
  ggplot(aes(x = FFM, y = PTA_AUC24_400, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 85), breaks = seq(0, 85, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 400 mgxh/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h"))
PTA_CRRT400_DAY1
```

```{r PTA AUC 400 mgxh/L day 1 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT400_DAY1<-  ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 1,],aes(x = FFM, y = PTA_AUC24_400,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 400 mgxh/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT400_DAY1
```
##### Day 2
```{r PTA AUC 400 mgxh/L day 2 CRRT patients}
library(ggplot2)
PTA_CRRT400_DAY2<-PTA_overall %>%
  filter(CRRT==1, DAY==2) %>%
  ggplot(aes(x = FFM, y = PTA_AUC24_400, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 85), breaks = seq(0, 85, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 400 mgxh/L in CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h"))
PTA_CRRT400_DAY2
```

```{r PTA AUC 400 mgxh/L day 2 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT400_DAY2<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 2,],aes(x = FFM, y = PTA_AUC24_400,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 400 mgxh/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT400_DAY2
```

##### Day 7
```{r PTA AUC 400 mgxh/L day 7 CRRT patients}
library(ggplot2)
PTA_CRRT400_DAY7<-PTA_overall %>%
  filter(CRRT==1, DAY==7) %>%
  ggplot(aes(x = FFM, y = PTA_AUC24_400, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 90), breaks = seq(0, 90, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 400 mgxh/L in CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h"))
PTA_CRRT400_DAY7
```

```{r PTA AUC 400 mgxh/L day 7 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT400_DAY7<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 7,],aes(x = FFM, y = PTA_AUC24_400,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 400 mgxh/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
         geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT400_DAY7
```

##### Day 14
```{r PTA AUC 400 mgxh/L day 14 CRRT patients}
library(ggplot2)
PTA_CRRT400_DAY14<-PTA_overall %>%
  filter(CRRT==1, DAY==14) %>%
  ggplot(aes(x = FFM, y = PTA_AUC24_400, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 90), breaks = seq(0, 90, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 400 mgxh/L in CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h"))
PTA_CRRT400_DAY14
```

```{r PTA AUC 400 mgxh/L day 14 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT400_DAY14<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 14,],aes(x = FFM, y = PTA_AUC24_400,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 400 mgxh/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
         geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT400_DAY14
```

#### Then I make line plots of PTA Cmin of 7.5 per day of all regimens 
##### Day 1
```{r PTA Cmin 7.5 mg/L day 1 CRRT patients}
library(ggplot2)
PTA_CRRT75_DAY1<-PTA_overall %>%
  filter(CRRT==1, DAY==1) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 90), breaks = seq(0, 90, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h"))
PTA_CRRT75_DAY1
```

```{r PTA Cmin 7.5 mg/L day 1 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT75_DAY1<-  ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 1,],aes(x = FFM, y = PTA_Cmin_75,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT75_DAY1
```
##### Day 2
```{r PTA Cmin 7.5 mg/L day 2 CRRT patients}
library(ggplot2)
PTA_CRRT75_DAY2<-PTA_overall %>%
  filter(CRRT==1, DAY==2) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 95), breaks = seq(0, 95, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT75_DAY2
```

```{r PTA Cmin 7.5 mg/L day 2 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT75_DAY2<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 2,],aes(x = FFM, y = PTA_Cmin_75,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
         geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT75_DAY2
```

##### Day 7
```{r PTA Cmin 7.5 mg/L day 7 CRRT patients}
library(ggplot2)
PTA_CRRT75_DAY7<-PTA_overall %>%
  filter(CRRT==1, DAY==7) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT75_DAY7
```

```{r PTA Cmin 7.5 mg/L day 7 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT75_DAY7<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 7,],aes(x = FFM, y = PTA_Cmin_75,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
         geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT75_DAY7
```

##### Day 14
```{r PTA Cmin 7.5 mg/L day 14 CRRT patients}
library(ggplot2)
PTA_CRRT75_DAY14<-PTA_overall %>%
  filter(CRRT==1, DAY==14) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT75_DAY14
```

```{r PTA Cmin 7.5 mg/L day 14 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT75_DAY14<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 14,],aes(x = FFM, y = PTA_Cmin_75,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT75_DAY14
```

#### Then I make line plots of PTA AUC of 200 per day of all regimens 
##### Day 1
```{r PTA AUC 200 mgxh/L day 1 CRRT patients}
library(ggplot2)
PTA_CRRT200_DAY1<-PTA_overall %>%
  filter(CRRT==1, DAY==1) %>%
  ggplot(aes(x = FFM, y = PTA_AUC24_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 200 mgxh/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT200_DAY1
```

```{r PTA AUC 200 mgxh/L day 1 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT200_DAY1<-  ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 1,],aes(x = FFM, y = PTA_AUC24_200,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 200 mgxh/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY1
```

##### Day 2
```{r PTA AUC 200 mgxh/L day 2 CRRT patients}
library(ggplot2)
PTA_CRRT200_DAY2<-PTA_overall %>%
  filter(CRRT==1, DAY==2) %>%
  ggplot(aes(x = FFM, y = PTA_AUC24_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 200 mgxh/L in CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT200_DAY2
```

```{r PTA AUC 200 mgxh/L day 2 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT200_DAY2<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 2,],aes(x = FFM, y = PTA_AUC24_200,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 200 mgxh/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY2

```

##### Day 7
```{r PTA AUC 200 mgxh/L day 7 CRRT patients}
library(ggplot2)
PTA_CRRT200_DAY7<-PTA_overall %>%
  filter(CRRT==1, DAY==7) %>%
  ggplot(aes(x = FFM, y = PTA_AUC24_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 200 mgxh/L in CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT200_DAY7
```

```{r PTA AUC 200 mgxh/L day 7 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT200_DAY7<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 7,],aes(x = FFM, y = PTA_AUC24_200,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 200 mgxh/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
         geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY7
```

##### Day 14
```{r PTA AUC 200 mgxh/L day 14 CRRT patients}
library(ggplot2)
PTA_CRRT200_DAY14<-PTA_overall %>%
  filter(CRRT==1, DAY==14) %>%
  ggplot(aes(x = FFM, y = PTA_AUC24_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 200 mgxh/L in CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT200_DAY14
```

```{r PTA AUC 200 mgxh/L day 14 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT200_DAY14<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 14,],aes(x = FFM, y = PTA_AUC24_200,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of AUC 200 mgxh/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) +
         geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY14
```

#### Then I make line plots of PTA Cmin of 80 mg/L per day of all regimens 
##### Day 1
```{r PTA Cmin 80 mg/L day 1 CRRT patients}
library(ggplot2)
PTA_CRRT80_DAY1<-PTA_overall %>%
  filter(CRRT==1, DAY==1) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY1

```
###### No toxicity on Day 1

```{r PTA Cmin 80 mg/L day 1 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT80_DAY1<-  ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 1,],aes(x = FFM, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)",
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",
                     ,expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) #+
#geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY1
```
###### No toxicity Day 1

##### Day 2
```{r PTA Cmin 80 mg/L day 2 CRRT patients}
library(ggplot2)
PTA_CRRT80_DAY2<-PTA_overall %>%
  filter(CRRT==1, DAY==2) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY2
```

###### No toxicity Day 2

```{r PTA Cmin 80 mg/L day 2 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT80_DAY2<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 2,],aes(x = FFM, y = PTA_Cmin_80,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",,expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) #+
#geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY2
```

###### Very small toxicity Day 2

##### Day 7
```{r PTA Cmin 80 mg/L day 7 CRRT patients}
library(ggplot2)
PTA_CRRT80_DAY7<-PTA_overall %>%
  filter(CRRT==1, DAY==7) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY7
```

###### No toxicity Day 7

```{r PTA Cmin 80 mg/L day 7 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT80_DAY7<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 7,],aes(x = FFM, y = PTA_Cmin_80,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) #+
         #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY7
```

###### Up to 20% toxicity for non-CRRT patients on Day 7

##### Day 14
```{r PTA Cmin 80 mg/L day 14 CRRT patients}
library(ggplot2)
PTA_CRRT80_DAY14<-PTA_overall %>%
  filter(CRRT==1, DAY==14) %>%
  ggplot(aes(x = FFM, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY14
```

###### No toxicity Day 14

```{r PTA Cmin 80 mg/L day 14 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT80_DAY14<- ggplot(PTA_overall[PTA_overall$CRRT == 0 & PTA_overall$DAY == 14,],aes(x = FFM, y = PTA_Cmin_80,group = Regimen, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 90), breaks = seq(30, 90, by = 5), name = "Fat Free Mass (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h")) #+
         #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY14
```

###### Up to 25% toxicity in non-CRRT patients on Day 14

#### Finally, save these plots
```{r save all the plots all at once part 1}
# Create a list of plot objects
plot_list <- list(PTA_CRRT400_DAY1, PTA_NOCRRT400_DAY1,
                  PTA_CRRT400_DAY14, PTA_NOCRRT400_DAY14,
                  PTA_CRRT400_DAY2, PTA_NOCRRT400_DAY2,
                  PTA_CRRT400_DAY7, PTA_NOCRRT400_DAY7,
                  PTA_CRRT15_DAY1, PTA_NOCRRT15_DAY1,
                  PTA_CRRT15_DAY2, PTA_NOCRRT15_DAY2,
                  PTA_CRRT15_DAY7, PTA_NOCRRT15_DAY7,
                  PTA_CRRT15_DAY14, PTA_NOCRRT15_DAY14)

# Define the file names
file_names <- c("PTA_CRRT400_DAY1.png", "PTA_NOCRRT400_DAY1.png",
                "PTA_CRRT400_DAY14.png", "PTA_NOCRRT400_DAY14.png",
                "PTA_CRRT400_DAY2.png", "PTA_NOCRRT400_DAY2.png",
                "PTA_CRRT400_DAY7.png", "PTA_NOCRRT400_DAY7.png",
                "PTA_CRRT15_DAY1.png", "PTA_NOCRRT15_DAY1.png",
                "PTA_CRRT15_DAY2.png", "PTA_NOCRRT15_DAY2.png",
                "PTA_CRRT15_DAY7.png", "PTA_NOCRRT15_DAY7.png",
                "PTA_CRRT15_DAY14.png", "PTA_NOCRRT15_DAY14.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_list)) {
  ggsave(file_names[i], plot = plot_list[[i]], dpi = 300, width = 10, height = 8)
}


```

```{r save all the plots all at once part 2}
# Create a list of plot objects
plot_list_02 <- list(PTA_CRRT200_DAY1, PTA_NOCRRT200_DAY1,
                  PTA_CRRT200_DAY14, PTA_NOCRRT200_DAY14,
                  PTA_CRRT200_DAY2, PTA_NOCRRT200_DAY2,
                  PTA_CRRT200_DAY7, PTA_NOCRRT200_DAY7,
                  PTA_CRRT75_DAY1, PTA_NOCRRT75_DAY1,
                  PTA_CRRT75_DAY2, PTA_NOCRRT75_DAY2,
                  PTA_CRRT75_DAY7, PTA_NOCRRT75_DAY7,
                  PTA_CRRT75_DAY14, PTA_NOCRRT75_DAY14)

# Define the file names
file_names_02 <- c("PTA_CRRT200_DAY1.png", "PTA_NOCRRT200_DAY1.png",
                "PTA_CRRT200_DAY14.png", "PTA_NOCRRT200_DAY14.png",
                "PTA_CRRT200_DAY2.png", "PTA_NOCRRT200_DAY2.png",
                "PTA_CRRT200_DAY7.png", "PTA_NOCRRT200_DAY7.png",
                "PTA_CRRT75_DAY1.png", "PTA_NOCRRT75_DAY1.png",
                "PTA_CRRT75_DAY2.png", "PTA_NOCRRT75_DAY2.png",
                "PTA_CRRT75_DAY7.png", "PTA_NOCRRT75_DAY7.png",
                "PTA_CRRT75_DAY14.png", "PTA_NOCRRT75_DAY14.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_list_02)) {
  ggsave(file_names_02[i], plot = plot_list_02[[i]], dpi = 300, width = 10, height = 8)
}


```

```{r save 8 toxicity plots}
# Create a list of plot objects
plot_list_03 <- list(PTA_CRRT80_DAY1, PTA_NOCRRT80_DAY1,
                  PTA_CRRT80_DAY14, PTA_NOCRRT80_DAY14,
                  PTA_CRRT80_DAY2, PTA_NOCRRT80_DAY2,
                  PTA_CRRT80_DAY7, PTA_NOCRRT80_DAY7)

# Define the file names
file_names_03 <- c("PTA_CRRT80_DAY1.png", "PTA_NOCRRT80_DAY1.png",
                "PTA_CRRT80_DAY14.png", "PTA_NOCRRT80_DAY14.png",
                "PTA_CRRT80_DAY2.png", "PTA_NOCRRT80_DAY2.png",
                "PTA_CRRT80_DAY7.png", "PTA_NOCRRT80_DAY7.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_list_03)) {
  ggsave(file_names_03[i], plot = plot_list_03[[i]], dpi = 300, width = 10, height = 8)
}
```


### Presentation with Isabel 120523
#### Make 4 plots per one slide - PTA of dosing regimens per Day 1, Day 2, Day 7 and Day 14
```{r for AUC 400 target attainment - non CRRT patients}
PTA_NOCRRT400_DAY1_nolegend<-PTA_NOCRRT400_DAY1+guides(color = "none")
PTA_NOCRRT400_DAY2_nolegend<-PTA_NOCRRT400_DAY2+guides(color = "none")
PTA_NOCRRT400_DAY7_nolegend<-PTA_NOCRRT400_DAY7+guides(color = "none")
library(cowplot)
# Combine the plots using plot_grid()
grid_noCRRT400 <- plot_grid(PTA_NOCRRT400_DAY1_nolegend, PTA_NOCRRT400_DAY2_nolegend, PTA_NOCRRT400_DAY7_nolegend, 
                  PTA_NOCRRT400_DAY14,nrow = 1, align = "h")

# Add a title to the grid
#title <- ggdraw() + 
        #draw_label("pcVPC of 10 final models", fontface = "bold", size = 18)

# Arrange the title and grid using plot_grid()
#combined_plot <- plot_grid(title, grid, ncol = 1, rel_heights = c(0.1, 1))

# Save the plot as a high-resolution png file
ggsave("combined_noCRRT400.png", grid_noCRRT400, dpi = 300, width = 30, height = 16)
```

#### Make 4 plots on DAY 1 draft
```{r modify the plots a bit}
PTA_CRRT80_DAY1_nolegend<-PTA_CRRT80_DAY1+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(plot.title = element_blank(), 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank())
PTA_NOCRRT80_DAY1_nolegend<-PTA_NOCRRT80_DAY1+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(plot.title = element_blank(), 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank())
PTA_NOCRRT80_DAY1_nolegend_1<-PTA_NOCRRT80_DAY1+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),legend.text = element_text(size = 7)) + theme(plot.title = element_blank(), 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank())

ggsave("day1.80.png", plot = PTA_CRRT80_DAY1_nolegend, dpi = 300, width = 2.7, height = 6)
ggsave("day1.80_01.png", plot = PTA_NOCRRT80_DAY1_nolegend_1, dpi = 300, width = 5.2, height = 6)
```

```{r combine the modified plots}
library(ggplot2)
library(cowplot)

# Create the grid of plots without titles and legends
grid_noCRRT80 <- plot_grid(PTA_CRRT80_DAY1_nolegend, PTA_NOCRRT80_DAY1_nolegend, 
                            #PTA_NOCRRT400_DAY7_nolegend, PTA_NOCRRT400_DAY14, 
                            nrow = 1, align = "h")

# Set up the plot title, axis titles, and legend title using labs() function
combined_plot_80 <- grid_noCRRT80 +
  labs(title = "PTA in patients without CRRT", # Set up the plot title
       x = "Fat Free Mass (kg)", # Set up the x-axis title
       y = "Probability of Target Attainment (%)", # Set up the y-axis title
       color = "Dosing Regimen") + # Set up the legend title
  theme(legend.position = "bottom") # Move the legend to the bottom of the plot

# Save the plot as a high-resolution png file
ggsave("combined_plot_noCRRT400.png", combined_plot, dpi = 300, width = 12, height = 6)

library(ggplot2)
library(cowplot)

# Create the grid of plots without titles and legends
grid_noCRRT80 <- plot_grid(PTA_CRRT80_DAY1_nolegend, PTA_NOCRRT80_DAY1_nolegend, 
                            nrow = 1, align = "h")

# Set up the plot title, axis titles, and legend title
plot_title <- "PTA in patients without CRRT"
x_axis_title <- "Fat Free Mass (kg)"
y_axis_title <- "Probability of Target Attainment (%)"
legend_title <- "Dosing Regimen"

# Create a ggdraw object for the combined plot
combined_plot_80 <- ggdraw() + 
  # Draw the combined plot
  draw_plot(grid_noCRRT80) +
  # Add the plot title
  draw_plot_label(label = plot_title, size = 12) +
                  #,x = 0.5, y = 1, # Adjust the position
                  #hjust = 0.6, vjust = 0.6) +
  # Add the x-axis title
  draw_plot_label(label = x_axis_title, size = 10) +#, 
                  #x = 0.5, y = 0.01, # Adjust the position
                  #hjust = 0.5, vjust = 0.5) +
  # Add the y-axis title
  draw_plot_label(label = y_axis_title, size = 10) #, 
                  #x = 0.01, y = 0.5, # Adjust the position
                  #angle = 90, # Rotate the text
                 + #hjust = 0.5, vjust = 0.5) + 
  # Add the legend title
  theme(legend.title = element_text(size = 12)) + 
  labs(color = PTA_overall$Regimen) + labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h"))

# Export the plot as a high-resolution PNG file
ggsave("combined_plot_80.png", plot = combined_plot_80, dpi = 300)


```

#### Make 8 plots on DAY 1 
```{r convert plots into 100 scale of y-axis}
PTA_CRRT15_DAY1_b<-PTA_CRRT15_DAY1+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)", 
                     expand = c(0,0))
PTA_NOCRRT15_DAY1_b<-PTA_NOCRRT15_DAY1+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)", 
                     expand = c(0,0))
PTA_CRRT15_DAY2_b<-PTA_CRRT15_DAY2+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)", 
                     expand = c(0,0))
PTA_NOCRRT15_DAY2_b<-PTA_NOCRRT15_DAY2+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)", 
                     expand = c(0,0))
PTA_CRRT15_DAY7_b<-PTA_CRRT15_DAY7+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)", 
                     expand = c(0,0))
PTA_CRRT15_DAY14_b<-PTA_CRRT15_DAY14+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 15 mg/L (%)", 
                     expand = c(0,0))
PTA_CRRT400_DAY1_b<-PTA_CRRT400_DAY1+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)", 
                     expand = c(0,0))
PTA_CRRT400_DAY2_b<-PTA_CRRT400_DAY2+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)", 
                     expand = c(0,0))
PTA_CRRT400_DAY7_b<-PTA_CRRT400_DAY7+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)", 
                     expand = c(0,0))
PTA_CRRT400_DAY14_b<-PTA_CRRT400_DAY14+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of AUC of 400 mgxh/L (%)", 
                     expand = c(0,0))
PTA_CRRT75_DAY1_b<-PTA_CRRT75_DAY1+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)", 
                     expand = c(0,0))
PTA_CRRT75_DAY2_b<-PTA_CRRT75_DAY2+scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)", 
                     expand = c(0,0))

```

```{r adjust 8 plots of day 1}
PTA_CRRT15_DAY1_nolegend<-PTA_CRRT15_DAY1_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 15 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT15_DAY1_nolegend<-PTA_NOCRRT15_DAY1_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 15 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_CRRT400_DAY1_nolegend<-PTA_CRRT400_DAY1_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 400 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT400_DAY1_nolegend<-PTA_NOCRRT400_DAY1+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 400 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))
          
PTA_CRRT75_DAY1_nolegend<-PTA_CRRT75_DAY1_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 7.5 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT75_DAY1_nolegend<-PTA_NOCRRT75_DAY1+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 7.5 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_CRRT200_DAY1_nolegend<-PTA_CRRT200_DAY1+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),legend.text = element_text(size = 7)) + theme( 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 200 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT200_DAY1_nolegend<-PTA_NOCRRT200_DAY1+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),legend.text = element_text(size = 7)) + theme( 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 200 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

#ggsave("day1.80.png", plot = PTA_CRRT80_DAY1_nolegend, dpi = 300, width = 2.7, height = 6)
#ggsave("day1.80_01.png", plot = PTA_NOCRRT80_DAY1_nolegend_1, dpi = 300, width = 5.2, height = 6)
```

```{r save 8 plots of day 1,warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/Presentation_110523")
# Create a list of plot objects
plot_day1_01 <- list(PTA_CRRT15_DAY1_nolegend, PTA_NOCRRT15_DAY1_nolegend,
                  PTA_CRRT400_DAY1_nolegend, PTA_NOCRRT400_DAY1_nolegend,
                  PTA_CRRT75_DAY1_nolegend, PTA_NOCRRT75_DAY1_nolegend)

# Define the file names
file_day1_01 <- c("PTA_CRRT15_DAY1_nolegend.png", "PTA_NOCRRT15_DAY1_nolegend.png",
                "PTA_CRRT400_DAY1_nolegend.png", "PTA_NOCRRT400_DAY1_nolegend.png",
                "PTA_CRRT75_DAY1_nolegend.png", "PTA_NOCRRT75_DAY1_nolegend.png")


plot_day1_02 <- list(PTA_CRRT200_DAY1_nolegend, PTA_NOCRRT200_DAY1_nolegend)

file_day1_02 <- c("PTA_CRRT200_DAY1_nolegend.png", "PTA_NOCRRT200_DAY1_nolegend.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_day1_01)) {
  ggsave(file_day1_01[i], plot = plot_day1_01[[i]], dpi = 300, width = 2.7, height = 6)
}

for (i in seq_along(plot_day1_02)) {
  ggsave(file_day1_02[i], plot = plot_day1_02[[i]], dpi = 300, width = 5.2, height = 6)
}
```

#### Make 8 plots on DAY 2

```{r adjust 8 plots of day 2}
PTA_CRRT15_DAY2_nolegend<-PTA_CRRT15_DAY2_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 15 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT15_DAY2_nolegend<-PTA_NOCRRT15_DAY2_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 15 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_CRRT400_DAY2_nolegend<-PTA_CRRT400_DAY2_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 400 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT400_DAY2_nolegend<-PTA_NOCRRT400_DAY2+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 400 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))
          
PTA_CRRT75_DAY2_nolegend<-PTA_CRRT75_DAY2_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 7.5 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT75_DAY2_nolegend<-PTA_NOCRRT75_DAY2+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 7.5 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_CRRT200_DAY2_nolegend<-PTA_CRRT200_DAY2+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),legend.text = element_text(size = 7)) + theme( 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 200 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT200_DAY2_nolegend<-PTA_NOCRRT200_DAY2+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),legend.text = element_text(size = 7)) + theme( 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 200 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

```

```{r save 8 plots of day 2,warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/Presentation_110523")
# Create a list of plot objects
plot_day2_01 <- list(PTA_CRRT15_DAY2_nolegend, PTA_NOCRRT15_DAY2_nolegend,
                  PTA_CRRT400_DAY2_nolegend, PTA_NOCRRT400_DAY2_nolegend,
                  PTA_CRRT75_DAY2_nolegend, PTA_NOCRRT75_DAY2_nolegend)

# Define the file names
file_day2_01 <- c("PTA_CRRT15_DAY2_nolegend.png", "PTA_NOCRRT15_DAY2_nolegend.png",
                "PTA_CRRT400_DAY2_nolegend.png", "PTA_NOCRRT400_DAY2_nolegend.png",
                "PTA_CRRT75_DAY2_nolegend.png", "PTA_NOCRRT75_DAY2_nolegend.png")


plot_day2_02 <- list(PTA_CRRT200_DAY2_nolegend, PTA_NOCRRT200_DAY2_nolegend)

file_day2_02 <- c("PTA_CRRT200_DAY2_nolegend.png", "PTA_NOCRRT200_DAY2_nolegend.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_day2_01)) {
  ggsave(file_day2_01[i], plot = plot_day2_01[[i]], dpi = 300, width = 2.7, height = 6)
}

for (i in seq_along(plot_day2_02)) {
  ggsave(file_day2_02[i], plot = plot_day2_02[[i]], dpi = 300, width = 5.2, height = 6)
}
```

#### Make 8 plots on DAY 7

```{r adjust 8 plots of day 7}
PTA_CRRT15_DAY7_nolegend<-PTA_CRRT15_DAY7_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 15 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT15_DAY7_nolegend<-PTA_NOCRRT15_DAY7+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 15 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_CRRT400_DAY7_nolegend<-PTA_CRRT400_DAY7_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 400 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT400_DAY7_nolegend<-PTA_NOCRRT400_DAY7+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 400 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))
          
PTA_CRRT75_DAY7_nolegend<-PTA_CRRT75_DAY7+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 7.5 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT75_DAY7_nolegend<-PTA_NOCRRT75_DAY7+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 7.5 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_CRRT200_DAY7_nolegend<-PTA_CRRT200_DAY7+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),legend.text = element_text(size = 7)) + theme( 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 200 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT200_DAY7_nolegend<-PTA_NOCRRT200_DAY7+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),legend.text = element_text(size = 7)) + theme( 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 200 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

```

```{r save 8 plots of day 7,warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/Presentation_110523")
# Create a list of plot objects
plot_day7_01 <- list(PTA_CRRT15_DAY7_nolegend, PTA_NOCRRT15_DAY7_nolegend,
                  PTA_CRRT400_DAY7_nolegend, PTA_NOCRRT400_DAY7_nolegend,
                  PTA_CRRT75_DAY7_nolegend, PTA_NOCRRT75_DAY7_nolegend)

# Define the file names
file_day7_01 <- c("PTA_CRRT15_DAY7_nolegend.png", "PTA_NOCRRT15_DAY7_nolegend.png",
                "PTA_CRRT400_DAY7_nolegend.png", "PTA_NOCRRT400_DAY7_nolegend.png",
                "PTA_CRRT75_DAY7_nolegend.png", "PTA_NOCRRT75_DAY7_nolegend.png")


plot_day7_02 <- list(PTA_CRRT200_DAY7_nolegend, PTA_NOCRRT200_DAY7_nolegend)

file_day7_02 <- c("PTA_CRRT200_DAY7_nolegend.png", "PTA_NOCRRT200_DAY7_nolegend.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_day7_01)) {
  ggsave(file_day7_01[i], plot = plot_day7_01[[i]], dpi = 300, width = 2.7, height = 6)
}

for (i in seq_along(plot_day7_02)) {
  ggsave(file_day7_02[i], plot = plot_day7_02[[i]], dpi = 300, width = 5.2, height = 6)
}
```

#### Make 8 plots on DAY 14

```{r adjust 8 plots of day 14}
PTA_CRRT15_DAY14_nolegend<-PTA_CRRT15_DAY14_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 15 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT15_DAY14_nolegend<-PTA_NOCRRT15_DAY14+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 15 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_CRRT400_DAY14_nolegend<-PTA_CRRT400_DAY14_b+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 400 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT400_DAY14_nolegend<-PTA_NOCRRT400_DAY14+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 400 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))
          
PTA_CRRT75_DAY14_nolegend<-PTA_CRRT75_DAY14+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 7.5 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT75_DAY14_nolegend<-PTA_NOCRRT75_DAY14+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("Cmin of 7.5 mg/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_CRRT200_DAY14_nolegend<-PTA_CRRT200_DAY14+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),legend.text = element_text(size = 7)) + theme( 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 200 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT200_DAY14_nolegend<-PTA_NOCRRT200_DAY14+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),legend.text = element_text(size = 7)) + theme( 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("AUC of 200 mgxh/L") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

```

```{r save 8 plots of day 14,warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/Presentation_110523")
# Create a list of plot objects
plot_day14_01 <- list(PTA_CRRT15_DAY14_nolegend, PTA_NOCRRT15_DAY14_nolegend,
                  PTA_CRRT400_DAY14_nolegend, PTA_NOCRRT400_DAY14_nolegend,
                  PTA_CRRT75_DAY14_nolegend, PTA_NOCRRT75_DAY14_nolegend)

# Define the file names
file_day14_01 <- c("PTA_CRRT15_DAY14_nolegend.png", "PTA_NOCRRT15_DAY14_nolegend.png",
                "PTA_CRRT400_DAY14_nolegend.png", "PTA_NOCRRT400_DAY14_nolegend.png",
                "PTA_CRRT75_DAY14_nolegend.png", "PTA_NOCRRT75_DAY14_nolegend.png")


plot_day14_02 <- list(PTA_CRRT200_DAY14_nolegend, PTA_NOCRRT200_DAY14_nolegend)

file_day14_02 <- c("PTA_CRRT200_DAY14_nolegend.png", "PTA_NOCRRT200_DAY14_nolegend.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_day14_01)) {
  ggsave(file_day14_01[i], plot = plot_day14_01[[i]], dpi = 300, width = 2.7, height = 6)
}

for (i in seq_along(plot_day14_02)) {
  ggsave(file_day14_02[i], plot = plot_day14_02[[i]], dpi = 300, width = 5.2, height = 6)
}
```

#### Make toxicity plots

```{r adjust 4 plots toxicity non-CRRT}
PTA_NOCRRT80_DAY1_nolegend<-PTA_NOCRRT80_DAY1+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 1") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT80_DAY2_nolegend<-PTA_NOCRRT80_DAY2+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 2") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT80_DAY7_nolegend<-PTA_NOCRRT80_DAY7+guides(color = "none")+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 7") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

PTA_NOCRRT80_DAY14_nolegend<-PTA_NOCRRT80_DAY14+ theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),legend.text = element_text(size = 7)) + theme( 
                                                           axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 14") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold"))

```

```{r save 8 plots of day 14,warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/Presentation_110523")
# Create a list of plot objects
plot_NOCRRT80 <- list(PTA_NOCRRT80_DAY1_nolegend, PTA_NOCRRT80_DAY2_nolegend,
                  PTA_NOCRRT80_DAY7_nolegend)

# Define the file names
file_NOCRRT80 <- c("PTA_NOCRRT80_DAY1_nolegend.png", "PTA_NOCRRT80_DAY2_nolegend.png",
                "PTA_NOCRRT80_DAY7_nolegend.png")


plot_NOCRRT80_02 <- list(PTA_NOCRRT80_DAY14_nolegend)

file_NOCRRT80_02 <- c("PTA_NOCRRT80_DAY14_nolegend.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_NOCRRT80)) {
  ggsave(file_NOCRRT80[i], plot = plot_NOCRRT80[[i]], dpi = 300, width = 2.7, height = 6)
}

for (i in seq_along(plot_NOCRRT80_02)) {
  ggsave(file_NOCRRT80_02[i], plot = plot_NOCRRT80_02[[i]], dpi = 300, width = 5.2, height = 6)
}
```


## Simulations after meeting with Isabel

### She suggested two more regimens: 1200 ld - 600 md (dosing_07) and 1200 ld - 800 md (dosing_08)
### The target we use is AUC of 200 and maybe a surrogate of Cmin 7.5 mg/L

### For standard dosing regimen

```{r standard dosing regimen CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
standard_dosing <- read.table("sdtab_stand.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
standard_dosing[] <- lapply(standard_dosing, as.numeric)

#eliminate all NAs
standard_dosing <- na.omit(standard_dosing)

# Extract only the trough events
standard_dosing_trough <- standard_dosing[standard_dosing$TROUGH == 1,]

# Create a new variable AUC24 for each ID
standard_dosing_trough <- standard_dosing_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
standard_dosing_trough<- standard_dosing_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
standard_dosing_trough$fAUC<- standard_dosing_trough$AUC24*0.89

#Eliminate peak column
standard_dosing_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_std <- subset(standard_dosing_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_std$PTA_Cmin_75 <- 100 * ave(PTA_std$DV >= 7.5, PTA_std$DAY, PTA_std$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_std$PTA_Cmin_80 <- 100 * ave(PTA_std$DV >= 80, PTA_std$DAY, PTA_std$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_std$PTA_fAUC_200 <- 100 * ave(PTA_std$fAUC >= 200, PTA_std$DAY, PTA_std$BW, FUN = mean)

# Create PTA_std_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_std_overall <- unique(PTA_std[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_std_overall, "PTA_std_overall.csv",quote=F,row.names = FALSE)
write.csv(standard_dosing_trough, "standard_dosing_trough.csv",quote=F,row.names = FALSE)

```

```{r standard dosing regimen non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
standard_dosing_noCRRT <- read.table("sdtab_stand_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
standard_dosing_noCRRT[] <- lapply(standard_dosing_noCRRT, as.numeric)

#eliminate all NAs
standard_dosing_noCRRT <- na.omit(standard_dosing_noCRRT)

# Extract only the trough events
standard_dosing_noCRRT_trough <- standard_dosing_noCRRT[standard_dosing_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
standard_dosing_noCRRT_trough <- standard_dosing_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
standard_dosing_noCRRT_trough<- standard_dosing_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
standard_dosing_noCRRT_trough$fAUC<- standard_dosing_noCRRT_trough$AUC24*0.89

#Eliminate peak column
standard_dosing_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_std_noCRRT <- subset(standard_dosing_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_std_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_std_noCRRT$DV >= 7.5, PTA_std_noCRRT$DAY, PTA_std_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_std_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_std_noCRRT$DV >= 80, PTA_std_noCRRT$DAY, PTA_std_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_std_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_std_noCRRT$fAUC >= 200, PTA_std_noCRRT$DAY, PTA_std_noCRRT$BW, FUN = mean)

# Create PTA_std_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_std_noCRRT_overall <- unique(PTA_std_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_std_noCRRT_overall, "PTA_std_noCRRT_overall.csv",quote=F,row.names = FALSE)
write.csv(standard_dosing_noCRRT_trough, "standard_dosing_noCRRT_trough.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 01

```{r dosing regimen 01 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_01 <- read.table("sdtab_01.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_01[] <- lapply(sdtab_01, as.numeric)

#eliminate all NAs
sdtab_01 <- na.omit(sdtab_01)

# Extract only the trough events
sdtab_01_trough <- sdtab_01[sdtab_01$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_01_trough <- sdtab_01_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_01_trough<- sdtab_01_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_01_trough$fAUC<- sdtab_01_trough$AUC24*0.89

#Eliminate peak column
sdtab_01_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_01 <- subset(sdtab_01_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_01$PTA_Cmin_75 <- 100 * ave(PTA_01$DV >= 7.5, PTA_01$DAY, PTA_01$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_01$PTA_Cmin_80 <- 100 * ave(PTA_01$DV >= 80, PTA_01$DAY, PTA_01$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_01$PTA_fAUC_200 <- 100 * ave(PTA_01$fAUC >= 200, PTA_01$DAY, PTA_01$BW, FUN = mean)

# Create PTA_01_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_01_overall <- unique(PTA_01[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_01_overall, "PTA_01_overall.csv",quote=F,row.names = FALSE)
write.csv(sdtab_01_trough, "sdtab_01_trough.csv",quote=F,row.names = FALSE)

```

```{r dosing regimen 01 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_01_noCRRT <- read.table("sdtab_01_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_01_noCRRT[] <- lapply(sdtab_01_noCRRT, as.numeric)

#eliminate all NAs
sdtab_01_noCRRT <- na.omit(sdtab_01_noCRRT)

# Extract only the trough events
sdtab_01_noCRRT_trough <- sdtab_01_noCRRT[sdtab_01_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_01_noCRRT_trough <- sdtab_01_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_01_noCRRT_trough<- sdtab_01_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_01_noCRRT_trough$fAUC<- sdtab_01_noCRRT_trough$AUC24*0.89

#Eliminate peak column
sdtab_01_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_01_noCRRT <- subset(sdtab_01_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_01_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_01_noCRRT$DV >= 7.5, PTA_01_noCRRT$DAY, PTA_01_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_01_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_01_noCRRT$DV >= 80, PTA_01_noCRRT$DAY, PTA_01_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_01_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_01_noCRRT$fAUC >= 200, PTA_01_noCRRT$DAY, PTA_01_noCRRT$BW, FUN = mean)

# Create PTA_01_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_01_noCRRT_overall <- unique(PTA_01_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_01_noCRRT_overall, "PTA_01_noCRRT_overall.csv",quote=F,row.names = FALSE)
write.csv(sdtab_01_noCRRT_trough, "sdtab_01_noCRRT_trough.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 02

```{r dosing regimen 02 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_02 <- read.table("sdtab_02.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_02[] <- lapply(sdtab_02, as.numeric)

#eliminate all NAs
sdtab_02 <- na.omit(sdtab_02)

# Extract only the trough events
sdtab_02_trough <- sdtab_02[sdtab_02$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_02_trough <- sdtab_02_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_02_trough<- sdtab_02_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_02_trough$fAUC<- sdtab_02_trough$AUC24*0.89

#Eliminate peak column
sdtab_02_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_02 <- subset(sdtab_02_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_02$PTA_Cmin_75 <- 100 * ave(PTA_02$DV >= 7.5, PTA_02$DAY, PTA_02$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_02$PTA_Cmin_80 <- 100 * ave(PTA_02$DV >= 80, PTA_02$DAY, PTA_02$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_02$PTA_fAUC_200 <- 100 * ave(PTA_02$fAUC >= 200, PTA_02$DAY, PTA_02$BW, FUN = mean)

# Create PTA_02_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_02_overall <- unique(PTA_02[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_02_overall, "PTA_02_overall.csv",quote=F,row.names = FALSE)
write.csv(sdtab_02_trough, "sdtab_02_trough.csv",quote=F,row.names = FALSE)

```

```{r dosing regimen 02 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_02_noCRRT <- read.table("sdtab_02_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_02_noCRRT[] <- lapply(sdtab_02_noCRRT, as.numeric)

#eliminate all NAs
sdtab_02_noCRRT <- na.omit(sdtab_02_noCRRT)

# Extract only the trough events
sdtab_02_noCRRT_trough <- sdtab_02_noCRRT[sdtab_02_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_02_noCRRT_trough <- sdtab_02_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_02_noCRRT_trough<- sdtab_02_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_02_noCRRT_trough$fAUC<- sdtab_02_noCRRT_trough$AUC24*0.89

#Eliminate peak column
sdtab_02_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_02_noCRRT <- subset(sdtab_02_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_02_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_02_noCRRT$DV >= 7.5, PTA_02_noCRRT$DAY, PTA_02_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_02_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_02_noCRRT$DV >= 80, PTA_02_noCRRT$DAY, PTA_02_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_02_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_02_noCRRT$fAUC >= 200, PTA_02_noCRRT$DAY, PTA_02_noCRRT$BW, FUN = mean)

# Create PTA_02_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_02_noCRRT_overall <- unique(PTA_02_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_02_noCRRT_overall, "PTA_02_noCRRT_overall.csv",quote=F,row.names = FALSE)
write.csv(sdtab_02_noCRRT_trough, "sdtab_02_noCRRT_trough.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 03

```{r dosing regimen 03 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_03 <- read.table("sdtab_03.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_03[] <- lapply(sdtab_03, as.numeric)

#eliminate all NAs
sdtab_03 <- na.omit(sdtab_03)

# Extract only the trough events
sdtab_03_trough <- sdtab_03[sdtab_03$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_03_trough <- sdtab_03_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_03_trough<- sdtab_03_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_03_trough$fAUC<- sdtab_03_trough$AUC24*0.89

#Eliminate peak column
sdtab_03_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_03 <- subset(sdtab_03_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_03$PTA_Cmin_75 <- 100 * ave(PTA_03$DV >= 7.5, PTA_03$DAY, PTA_03$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_03$PTA_Cmin_80 <- 100 * ave(PTA_03$DV >= 80, PTA_03$DAY, PTA_03$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_03$PTA_fAUC_200 <- 100 * ave(PTA_03$fAUC >= 200, PTA_03$DAY, PTA_03$BW, FUN = mean)

# Create PTA_03_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_03_overall <- unique(PTA_03[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_03_overall, "PTA_03_overall.csv",quote=F,row.names = FALSE)
write.csv(sdtab_03_trough, "sdtab_03_trough.csv",quote=F,row.names = FALSE)

```

```{r dosing regimen 03 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_03_noCRRT <- read.table("sdtab_03_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_03_noCRRT[] <- lapply(sdtab_03_noCRRT, as.numeric)

#eliminate all NAs
sdtab_03_noCRRT <- na.omit(sdtab_03_noCRRT)

# Extract only the trough events
sdtab_03_noCRRT_trough <- sdtab_03_noCRRT[sdtab_03_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_03_noCRRT_trough <- sdtab_03_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_03_noCRRT_trough<- sdtab_03_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_03_noCRRT_trough$fAUC<- sdtab_03_noCRRT_trough$AUC24*0.89

#Eliminate peak column
sdtab_03_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_03_noCRRT <- subset(sdtab_03_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_03_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_03_noCRRT$DV >= 7.5, PTA_03_noCRRT$DAY, PTA_03_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_03_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_03_noCRRT$DV >= 80, PTA_03_noCRRT$DAY, PTA_03_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_03_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_03_noCRRT$fAUC >= 200, PTA_03_noCRRT$DAY, PTA_03_noCRRT$BW, FUN = mean)

# Create PTA_03_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_03_noCRRT_overall <- unique(PTA_03_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_03_noCRRT_overall, "PTA_03_noCRRT_overall.csv",quote=F,row.names = FALSE)
write.csv(sdtab_03_noCRRT_trough, "sdtab_03_noCRRT_trough.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 04

```{r dosing regimen 04 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_04 <- read.table("sdtab_04.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_04[] <- lapply(sdtab_04, as.numeric)

#eliminate all NAs
sdtab_04 <- na.omit(sdtab_04)

# Extract only the trough events
# Erwin's comments 160523, only compare PTA at 24h
sdtab_04_trough <- sdtab_04[sdtab_04$TROUGH == 1 & sdtab_04$OCC %% 2 == 0, ]

# Create a new variable AUC24 for each ID
sdtab_04_trough <- sdtab_04_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_04_trough<- sdtab_04_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_04_trough$fAUC<- sdtab_04_trough$AUC24*0.89

#Eliminate peak column
sdtab_04_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_04 <- subset(sdtab_04_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_04$PTA_Cmin_75 <- 100 * ave(PTA_04$DV >= 7.5, PTA_04$DAY, PTA_04$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_04$PTA_Cmin_80 <- 100 * ave(PTA_04$DV >= 80, PTA_04$DAY, PTA_04$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_04$PTA_fAUC_200 <- 100 * ave(PTA_04$fAUC >= 200, PTA_04$DAY, PTA_04$BW, FUN = mean)

# Create PTA_04_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_04_overall <- unique(PTA_04[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_04_overall, "PTA_04_overall.csv",quote=F,row.names = FALSE)
write.csv(sdtab_04_trough, "sdtab_04_trough.csv",quote=F,row.names = FALSE)

```

```{r dosing regimen 04 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_04_noCRRT <- read.table("sdtab_04_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_04_noCRRT[] <- lapply(sdtab_04_noCRRT, as.numeric)

#eliminate all NAs
sdtab_04_noCRRT <- na.omit(sdtab_04_noCRRT)

# Extract only the trough events
# Erwin's comments 160523, only compare PTA at 24h
sdtab_04_noCRRT_trough <- sdtab_04_noCRRT[sdtab_04_noCRRT$TROUGH == 1 & sdtab_04_noCRRT$OCC %% 2 == 0,]

# Create a new variable AUC24 for each ID
sdtab_04_noCRRT_trough <- sdtab_04_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_04_noCRRT_trough<- sdtab_04_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_04_noCRRT_trough$fAUC<- sdtab_04_noCRRT_trough$AUC24*0.89

#Eliminate peak column
sdtab_04_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_04_noCRRT <- subset(sdtab_04_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_04_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_04_noCRRT$DV >= 7.5, PTA_04_noCRRT$DAY, PTA_04_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_04_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_04_noCRRT$DV >= 80, PTA_04_noCRRT$DAY, PTA_04_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_04_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_04_noCRRT$fAUC >= 200, PTA_04_noCRRT$DAY, PTA_04_noCRRT$BW, FUN = mean)

# Create PTA_04_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_04_noCRRT_overall <- unique(PTA_04_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_04_noCRRT_overall, "PTA_04_noCRRT_overall.csv",quote=F,row.names = FALSE)
write.csv(sdtab_04_noCRRT_trough, "sdtab_04_noCRRT_trough.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 05

```{r dosing regimen 05 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_05 <- read.table("sdtab_05.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_05[] <- lapply(sdtab_05, as.numeric)

#eliminate all NAs
sdtab_05 <- na.omit(sdtab_05)

# Extract only the trough events
sdtab_05_trough <- sdtab_05[sdtab_05$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_05_trough <- sdtab_05_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_05_trough<- sdtab_05_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_05_trough$fAUC<- sdtab_05_trough$AUC24*0.89

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_05 <- subset(sdtab_05_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_05$PTA_Cmin_75 <- 100 * ave(PTA_05$DV >= 7.5, PTA_05$DAY, PTA_05$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_05$PTA_Cmin_80 <- 100 * ave(PTA_05$DV >= 80, PTA_05$DAY, PTA_05$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_05$PTA_fAUC_200 <- 100 * ave(PTA_05$fAUC >= 200, PTA_05$DAY, PTA_05$BW, FUN = mean)

# Create PTA_05_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_05_overall <- unique(PTA_05[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_05_overall, "PTA_05_overall.csv",quote=F,row.names = FALSE)
write.csv(sdtab_05_trough, "sdtab_05_trough.csv",quote=F,row.names = FALSE)

```

```{r dosing regimen 04 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_05_noCRRT <- read.table("sdtab_05_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_05_noCRRT[] <- lapply(sdtab_05_noCRRT, as.numeric)

#eliminate all NAs
sdtab_05_noCRRT <- na.omit(sdtab_05_noCRRT)

# Extract only the trough events
sdtab_05_noCRRT_trough <- sdtab_05_noCRRT[sdtab_05_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_05_noCRRT_trough <- sdtab_05_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_05_noCRRT_trough<- sdtab_05_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_05_noCRRT_trough$fAUC<- sdtab_05_noCRRT_trough$AUC24*0.89

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_05_noCRRT <- subset(sdtab_05_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_05_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_05_noCRRT$DV >= 7.5, PTA_05_noCRRT$DAY, PTA_05_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_05_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_05_noCRRT$DV >= 80, PTA_05_noCRRT$DAY, PTA_05_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_05_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_05_noCRRT$fAUC >= 200, PTA_05_noCRRT$DAY, PTA_05_noCRRT$BW, FUN = mean)

# Create PTA_05_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_05_noCRRT_overall <- unique(PTA_05_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_05_noCRRT_trough, "sdtab_05_noCRRT_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_05_noCRRT_overall, "PTA_05_noCRRT_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 06

```{r dosing regimen 06 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_06 <- read.table("sdtab_06.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_06[] <- lapply(sdtab_06, as.numeric)

#eliminate all NAs
sdtab_06 <- na.omit(sdtab_06)

# Extract only the trough events
sdtab_06_trough <- sdtab_06[sdtab_06$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_06_trough <- sdtab_06_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_06_trough<- sdtab_06_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_06_trough$fAUC<- sdtab_06_trough$AUC24*0.89

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_06 <- subset(sdtab_06_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_06$PTA_Cmin_75 <- 100 * ave(PTA_06$DV >= 7.5, PTA_06$DAY, PTA_06$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_06$PTA_Cmin_80 <- 100 * ave(PTA_06$DV >= 80, PTA_06$DAY, PTA_06$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_06$PTA_fAUC_200 <- 100 * ave(PTA_06$fAUC >= 200, PTA_06$DAY, PTA_06$BW, FUN = mean)

# Create PTA_06_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_06_overall <- unique(PTA_06[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_06_trough, "sdtab_06_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_06_overall, "PTA_06_overall.csv",quote=F,row.names = FALSE)

```

```{r dosing regimen 06 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_06_noCRRT <- read.table("sdtab_06_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_06_noCRRT[] <- lapply(sdtab_06_noCRRT, as.numeric)

#eliminate all NAs
sdtab_06_noCRRT <- na.omit(sdtab_06_noCRRT)

# Extract only the trough events
sdtab_06_noCRRT_trough <- sdtab_06_noCRRT[sdtab_06_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_06_noCRRT_trough <- sdtab_06_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_06_noCRRT_trough<- sdtab_06_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_06_noCRRT_trough$fAUC<- sdtab_06_noCRRT_trough$AUC24*0.89

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_06_noCRRT <- subset(sdtab_06_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_06_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_06_noCRRT$DV >= 7.5, PTA_06_noCRRT$DAY, PTA_06_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_06_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_06_noCRRT$DV >= 80, PTA_06_noCRRT$DAY, PTA_06_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_06_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_06_noCRRT$fAUC >= 200, PTA_06_noCRRT$DAY, PTA_06_noCRRT$BW, FUN = mean)

# Create PTA_06_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_06_noCRRT_overall <- unique(PTA_06_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_06_noCRRT_trough, "sdtab_06_noCRRT_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_06_noCRRT_overall, "PTA_06_noCRRT_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 07

```{r dosing regimen 07 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_07 <- read.table("sdtab_07.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_07[] <- lapply(sdtab_07, as.numeric)

#eliminate all NAs
sdtab_07 <- na.omit(sdtab_07)

# Extract only the trough events
sdtab_07_trough <- sdtab_07[sdtab_07$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_07_trough <- sdtab_07_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_07_trough<- sdtab_07_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_07_trough$fAUC<- sdtab_07_trough$AUC24*0.89

#Eliminate peak column
sdtab_07_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_07 <- subset(sdtab_07_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_07$PTA_Cmin_75 <- 100 * ave(PTA_07$DV >= 7.5, PTA_07$DAY, PTA_07$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_07$PTA_Cmin_80 <- 100 * ave(PTA_07$DV >= 80, PTA_07$DAY, PTA_07$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_07$PTA_fAUC_200 <- 100 * ave(PTA_07$fAUC >= 200, PTA_07$DAY, PTA_07$BW, FUN = mean)

# Create PTA_07_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_07_overall <- unique(PTA_07[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_07_trough, "sdtab_07_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_07_overall, "PTA_07_overall.csv",quote=F,row.names = FALSE)

```

```{r dosing regimen 06 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_07_noCRRT <- read.table("sdtab_07_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_07_noCRRT[] <- lapply(sdtab_07_noCRRT, as.numeric)

#eliminate all NAs
sdtab_07_noCRRT <- na.omit(sdtab_07_noCRRT)

# Extract only the trough events
sdtab_07_noCRRT_trough <- sdtab_07_noCRRT[sdtab_07_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_07_noCRRT_trough <- sdtab_07_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_07_noCRRT_trough<- sdtab_07_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_07_noCRRT_trough$fAUC<- sdtab_07_noCRRT_trough$AUC24*0.89

#Eliminate peak column
sdtab_07_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_07_noCRRT <- subset(sdtab_07_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_07_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_07_noCRRT$DV >= 7.5, PTA_07_noCRRT$DAY, PTA_07_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_07_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_07_noCRRT$DV >= 80, PTA_07_noCRRT$DAY, PTA_07_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_07_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_07_noCRRT$fAUC >= 200, PTA_07_noCRRT$DAY, PTA_07_noCRRT$BW, FUN = mean)

# Create PTA_07_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_07_noCRRT_overall <- unique(PTA_07_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_07_noCRRT_trough, "sdtab_07_noCRRT_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_07_noCRRT_overall, "PTA_07_noCRRT_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 08

```{r dosing regimen 08 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_08 <- read.table("sdtab_08.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_08[] <- lapply(sdtab_08, as.numeric)

#eliminate all NAs
sdtab_08 <- na.omit(sdtab_08)

# Extract only the trough events
sdtab_08_trough <- sdtab_08[sdtab_08$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_08_trough <- sdtab_08_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_08_trough<- sdtab_08_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_08_trough$fAUC<- sdtab_08_trough$AUC24*0.89

#Eliminate peak column
sdtab_08_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_08 <- subset(sdtab_08_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_08$PTA_Cmin_75 <- 100 * ave(PTA_08$DV >= 7.5, PTA_08$DAY, PTA_08$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_08$PTA_Cmin_80 <- 100 * ave(PTA_08$DV >= 80, PTA_08$DAY, PTA_08$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_08$PTA_fAUC_200 <- 100 * ave(PTA_08$fAUC >= 200, PTA_08$DAY, PTA_08$BW, FUN = mean)

# Create PTA_08_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_08_overall <- unique(PTA_08[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_08_trough, "sdtab_08_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_08_overall, "PTA_08_overall.csv",quote=F,row.names = FALSE)

```

```{r dosing regimen 08 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_08_noCRRT <- read.table("sdtab_08_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_08_noCRRT[] <- lapply(sdtab_08_noCRRT, as.numeric)

#eliminate all NAs
sdtab_08_noCRRT <- na.omit(sdtab_08_noCRRT)

# Extract only the trough events
sdtab_08_noCRRT_trough <- sdtab_08_noCRRT[sdtab_08_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_08_noCRRT_trough <- sdtab_08_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_08_noCRRT_trough<- sdtab_08_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_08_noCRRT_trough$fAUC<- sdtab_08_noCRRT_trough$AUC24*0.89

#Eliminate peak column
sdtab_08_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_08_noCRRT <- subset(sdtab_08_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_08_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_08_noCRRT$DV >= 7.5, PTA_08_noCRRT$DAY, PTA_08_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_08_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_08_noCRRT$DV >= 80, PTA_08_noCRRT$DAY, PTA_08_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_08_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_08_noCRRT$fAUC >= 200, PTA_08_noCRRT$DAY, PTA_08_noCRRT$BW, FUN = mean)

# Create PTA_08_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_08_noCRRT_overall <- unique(PTA_08_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_08_noCRRT_trough, "sdtab_08_noCRRT_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_08_noCRRT_overall, "PTA_08_noCRRT_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 09

```{r dosing regimen 09 for CRRT patients, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_09 <- read.table("sdtab_09.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_09[] <- lapply(sdtab_09, as.numeric)

#eliminate all NAs
sdtab_09 <- na.omit(sdtab_09)

# Extract only the trough events
sdtab_09_trough <- sdtab_09[sdtab_09$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_09_trough <- sdtab_09_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_09_trough<- sdtab_09_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_09_trough$fAUC<- sdtab_09_trough$AUC24*0.89

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_09 <- subset(sdtab_09_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_09$PTA_Cmin_75 <- 100 * ave(PTA_09$DV >= 7.5, PTA_09$DAY, PTA_09$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_09$PTA_Cmin_80 <- 100 * ave(PTA_09$DV >= 80, PTA_09$DAY, PTA_09$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_09$PTA_fAUC_200 <- 100 * ave(PTA_09$fAUC >= 200, PTA_09$DAY, PTA_09$BW, FUN = mean)

# Create PTA_09_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_09_overall <- unique(PTA_09[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_09_trough, "sdtab_09_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_09_overall, "PTA_09_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 10

```{r dosing regimen 10 for non-CRRT patients, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_10 <- read.table("sdtab_10.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_10[] <- lapply(sdtab_10, as.numeric)

#eliminate all NAs
sdtab_10 <- na.omit(sdtab_10)

# Extract only the trough events
sdtab_10_trough <- sdtab_10[sdtab_10$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_10_trough <- sdtab_10_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_10_trough<- sdtab_10_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_10_trough$fAUC<- sdtab_10_trough$AUC24*0.89

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_10 <- subset(sdtab_10_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_10$PTA_Cmin_75 <- 100 * ave(PTA_10$DV >= 7.5, PTA_10$DAY, PTA_10$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_10$PTA_Cmin_80 <- 100 * ave(PTA_10$DV >= 80, PTA_10$DAY, PTA_10$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_10$PTA_fAUC_200 <- 100 * ave(PTA_10$fAUC >= 200, PTA_10$DAY, PTA_10$BW, FUN = mean)

# Create PTA_10_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_10_overall <- unique(PTA_10[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_10_trough, "sdtab_10_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_10_overall, "PTA_10_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 11

```{r dosing regimen 11 for non-CRRT patients, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_11 <- read.table("sdtab_11.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_11[] <- lapply(sdtab_11, as.numeric)

#eliminate all NAs
sdtab_11 <- na.omit(sdtab_11)

# Extract only the trough events
sdtab_11_trough <- sdtab_11[sdtab_11$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_11_trough <- sdtab_11_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_11_trough<- sdtab_11_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_11_trough$fAUC<- sdtab_11_trough$AUC24*0.89

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_11 <- subset(sdtab_11_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_11$PTA_Cmin_75 <- 100 * ave(PTA_11$DV >= 7.5, PTA_11$DAY, PTA_11$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_11$PTA_Cmin_80 <- 100 * ave(PTA_11$DV >= 80, PTA_11$DAY, PTA_11$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_11$PTA_fAUC_200 <- 100 * ave(PTA_11$fAUC >= 200, PTA_11$DAY, PTA_11$BW, FUN = mean)

# Create PTA_11_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_11_overall <- unique(PTA_11[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_11_trough, "sdtab_11_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_11_overall, "PTA_11_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 12

```{r dosing regimen 12 for non-CRRT patients, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_12 <- read.table("sdtab_12.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_12[] <- lapply(sdtab_12, as.numeric)

#eliminate all NAs
sdtab_12 <- na.omit(sdtab_12)

# Extract only the trough events
sdtab_12_trough <- sdtab_12[sdtab_12$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_12_trough <- sdtab_12_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_12_trough<- sdtab_12_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 12%)
sdtab_12_trough$fAUC<- sdtab_12_trough$AUC24*0.89

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_12 <- subset(sdtab_12_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_12$PTA_Cmin_75 <- 100 * ave(PTA_12$DV >= 7.5, PTA_12$DAY, PTA_12$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_12$PTA_Cmin_80 <- 100 * ave(PTA_12$DV >= 80, PTA_12$DAY, PTA_12$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_12$PTA_fAUC_200 <- 100 * ave(PTA_12$fAUC >= 200, PTA_12$DAY, PTA_12$BW, FUN = mean)

# Create PTA_12_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_12_overall <- unique(PTA_12[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_12_trough, "sdtab_12_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_12_overall, "PTA_12_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 13

```{r dosing regimen 12 for non-CRRT patients, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_13 <- read.table("sdtab_13.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_13[] <- lapply(sdtab_13, as.numeric)

#eliminate all NAs
sdtab_13 <- na.omit(sdtab_13)

# Extract only the trough events
sdtab_13_trough <- sdtab_13[sdtab_13$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_13_trough <- sdtab_13_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_13_trough<- sdtab_13_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 13%)
sdtab_13_trough$fAUC<- sdtab_13_trough$AUC24*0.89

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_13 <- subset(sdtab_13_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_13$PTA_Cmin_75 <- 100 * ave(PTA_13$DV >= 7.5, PTA_13$DAY, PTA_13$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_13$PTA_Cmin_80 <- 100 * ave(PTA_13$DV >= 80, PTA_13$DAY, PTA_13$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_13$PTA_fAUC_200 <- 100 * ave(PTA_13$fAUC >= 200, PTA_13$DAY, PTA_13$BW, FUN = mean)

# Create PTA_13_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_13_overall <- unique(PTA_13[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_13_trough, "sdtab_13_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_13_overall, "PTA_13_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 14

```{r dosing regimen 14 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_14 <- read.table("sdtab_14.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_14[] <- lapply(sdtab_14, as.numeric)

#eliminate all NAs
sdtab_14 <- na.omit(sdtab_14)

# Extract only the trough events
sdtab_14_trough <- sdtab_14[sdtab_14$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_14_trough <- sdtab_14_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_14_trough<- sdtab_14_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_14_trough$fAUC<- sdtab_14_trough$AUC24*0.89

#Eliminate peak column
sdtab_14_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_14 <- subset(sdtab_14_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_14$PTA_Cmin_75 <- 100 * ave(PTA_14$DV >= 7.5, PTA_14$DAY, PTA_14$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_14$PTA_Cmin_80 <- 100 * ave(PTA_14$DV >= 80, PTA_14$DAY, PTA_14$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_14$PTA_fAUC_200 <- 100 * ave(PTA_14$fAUC >= 200, PTA_14$DAY, PTA_14$BW, FUN = mean)

# Create PTA_14_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_14_overall <- unique(PTA_14[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_14_trough, "sdtab_14_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_14_overall, "PTA_14_overall.csv",quote=F,row.names = FALSE)

```

```{r dosing regimen 14 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_14_noCRRT <- read.table("sdtab_14_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_14_noCRRT[] <- lapply(sdtab_14_noCRRT, as.numeric)

#eliminate all NAs
sdtab_14_noCRRT <- na.omit(sdtab_14_noCRRT)

# Extract only the trough events
sdtab_14_noCRRT_trough <- sdtab_14_noCRRT[sdtab_14_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_14_noCRRT_trough <- sdtab_14_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_14_noCRRT_trough<- sdtab_14_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_14_noCRRT_trough$fAUC<- sdtab_14_noCRRT_trough$AUC24*0.89

#Eliminate peak column
sdtab_14_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_14_noCRRT <- subset(sdtab_14_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_14_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_14_noCRRT$DV >= 7.5, PTA_14_noCRRT$DAY, PTA_14_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_14_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_14_noCRRT$DV >= 80, PTA_14_noCRRT$DAY, PTA_14_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_14_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_14_noCRRT$fAUC >= 200, PTA_14_noCRRT$DAY, PTA_14_noCRRT$BW, FUN = mean)

# Create PTA_14_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_14_noCRRT_overall <- unique(PTA_14_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_14_noCRRT_trough, "sdtab_14_noCRRT_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_14_noCRRT_overall, "PTA_14_noCRRT_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 15

```{r dosing regimen 15 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_15 <- read.table("sdtab_15.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_15[] <- lapply(sdtab_15, as.numeric)

#eliminate all NAs
sdtab_15 <- na.omit(sdtab_15)

# Extract only the trough events
sdtab_15_trough <- sdtab_15[sdtab_15$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_15_trough <- sdtab_15_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_15_trough<- sdtab_15_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_15_trough$fAUC<- sdtab_15_trough$AUC24*0.89

#Eliminate peak column
sdtab_15_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_15 <- subset(sdtab_15_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_15$PTA_Cmin_75 <- 100 * ave(PTA_15$DV >= 7.5, PTA_15$DAY, PTA_15$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_15$PTA_Cmin_80 <- 100 * ave(PTA_15$DV >= 80, PTA_15$DAY, PTA_15$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_15$PTA_fAUC_200 <- 100 * ave(PTA_15$fAUC >= 200, PTA_15$DAY, PTA_15$BW, FUN = mean)

# Create PTA_15_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_15_overall <- unique(PTA_15[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_15_trough, "sdtab_15_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_15_overall, "PTA_15_overall.csv",quote=F,row.names = FALSE)

```

```{r dosing regimen 15 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_15_noCRRT <- read.table("sdtab_15_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_15_noCRRT[] <- lapply(sdtab_15_noCRRT, as.numeric)

#eliminate all NAs
sdtab_15_noCRRT <- na.omit(sdtab_15_noCRRT)

# Extract only the trough events
sdtab_15_noCRRT_trough <- sdtab_15_noCRRT[sdtab_15_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_15_noCRRT_trough <- sdtab_15_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_15_noCRRT_trough<- sdtab_15_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_15_noCRRT_trough$fAUC<- sdtab_15_noCRRT_trough$AUC24*0.89

#Eliminate peak column
sdtab_15_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_15_noCRRT <- subset(sdtab_15_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_15_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_15_noCRRT$DV >= 7.5, PTA_15_noCRRT$DAY, PTA_15_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_15_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_15_noCRRT$DV >= 80, PTA_15_noCRRT$DAY, PTA_15_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_15_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_15_noCRRT$fAUC >= 200, PTA_15_noCRRT$DAY, PTA_15_noCRRT$BW, FUN = mean)

# Create PTA_15_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_15_noCRRT_overall <- unique(PTA_15_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_15_noCRRT_trough, "sdtab_15_noCRRT_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_15_noCRRT_overall, "PTA_15_noCRRT_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 16

```{r dosing regimen 16 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_16 <- read.table("sdtab_16.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_16[] <- lapply(sdtab_16, as.numeric)

#eliminate all NAs
sdtab_16 <- na.omit(sdtab_16)

# Extract only the trough events
sdtab_16_trough <- sdtab_16[sdtab_16$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_16_trough <- sdtab_16_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_16_trough<- sdtab_16_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_16_trough$fAUC<- sdtab_16_trough$AUC24*0.89

#Eliminate peak column
sdtab_16_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_16 <- subset(sdtab_16_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_16$PTA_Cmin_75 <- 100 * ave(PTA_16$DV >= 7.5, PTA_16$DAY, PTA_16$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_16$PTA_Cmin_80 <- 100 * ave(PTA_16$DV >= 80, PTA_16$DAY, PTA_16$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_16$PTA_fAUC_200 <- 100 * ave(PTA_16$fAUC >= 200, PTA_16$DAY, PTA_16$BW, FUN = mean)

# Create PTA_16_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_16_overall <- unique(PTA_16[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_16_trough, "sdtab_16_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_16_overall, "PTA_16_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 17

```{r dosing regimen 17 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_17_noCRRT <- read.table("sdtab_17_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_17_noCRRT[] <- lapply(sdtab_17_noCRRT, as.numeric)

#eliminate all NAs
sdtab_17_noCRRT <- na.omit(sdtab_17_noCRRT)

# Extract only the trough events
sdtab_17_noCRRT_trough <- sdtab_17_noCRRT[sdtab_17_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_17_noCRRT_trough <- sdtab_17_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_17_noCRRT_trough<- sdtab_17_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_17_noCRRT_trough$fAUC<- sdtab_17_noCRRT_trough$AUC24*0.89

#Eliminate peak column
sdtab_17_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_17_noCRRT <- subset(sdtab_17_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_17_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_17_noCRRT$DV >= 7.5, PTA_17_noCRRT$DAY, PTA_17_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_17_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_17_noCRRT$DV >= 80, PTA_17_noCRRT$DAY, PTA_17_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_17_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_17_noCRRT$fAUC >= 200, PTA_17_noCRRT$DAY, PTA_17_noCRRT$BW, FUN = mean)

# Create PTA_17_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_17_noCRRT_overall <- unique(PTA_17_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_17_noCRRT_trough, "sdtab_17_noCRRT_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_17_noCRRT_overall, "PTA_17_noCRRT_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 18

```{r dosing regimen 18 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_18 <- read.table("sdtab_18.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_18[] <- lapply(sdtab_18, as.numeric)

#eliminate all NAs
sdtab_18 <- na.omit(sdtab_18)

# Extract only the trough events
sdtab_18_trough <- sdtab_18[sdtab_18$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_18_trough <- sdtab_18_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_18_trough<- sdtab_18_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_18_trough$fAUC<- sdtab_18_trough$AUC24*0.89

#Eliminate peak column
sdtab_18_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_18 <- subset(sdtab_18_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_18$PTA_Cmin_75 <- 100 * ave(PTA_18$DV >= 7.5, PTA_18$DAY, PTA_18$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_18$PTA_Cmin_80 <- 100 * ave(PTA_18$DV >= 80, PTA_18$DAY, PTA_18$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_18$PTA_fAUC_200 <- 100 * ave(PTA_18$fAUC >= 200, PTA_18$DAY, PTA_18$BW, FUN = mean)

# Create PTA_18_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_18_overall <- unique(PTA_18[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_18_trough, "sdtab_18_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_18_overall, "PTA_18_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 19

```{r dosing regimen 19 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_19_noCRRT <- read.table("sdtab_19_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_19_noCRRT[] <- lapply(sdtab_19_noCRRT, as.numeric)

#eliminate all NAs
sdtab_19_noCRRT <- na.omit(sdtab_19_noCRRT)

# Extract only the trough events
sdtab_19_noCRRT_trough <- sdtab_19_noCRRT[sdtab_19_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_19_noCRRT_trough <- sdtab_19_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_19_noCRRT_trough<- sdtab_19_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_19_noCRRT_trough$fAUC<- sdtab_19_noCRRT_trough$AUC24*0.89

#Eliminate peak column
sdtab_19_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_19_noCRRT <- subset(sdtab_19_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_19_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_19_noCRRT$DV >= 7.5, PTA_19_noCRRT$DAY, PTA_19_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_19_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_19_noCRRT$DV >= 80, PTA_19_noCRRT$DAY, PTA_19_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_19_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_19_noCRRT$fAUC >= 200, PTA_19_noCRRT$DAY, PTA_19_noCRRT$BW, FUN = mean)

# Create PTA_19_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_19_noCRRT_overall <- unique(PTA_19_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_19_noCRRT_trough, "sdtab_19_noCRRT_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_19_noCRRT_overall, "PTA_19_noCRRT_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 20

```{r dosing regimen 20 CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_20 <- read.table("sdtab_20.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_20[] <- lapply(sdtab_20, as.numeric)

#eliminate all NAs
sdtab_20 <- na.omit(sdtab_20)

# Extract only the trough events
sdtab_20_trough <- sdtab_20[sdtab_20$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_20_trough <- sdtab_20_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_20_trough<- sdtab_20_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_20_trough$fAUC<- sdtab_20_trough$AUC24*0.89

#Eliminate peak column
sdtab_20_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_20 <- subset(sdtab_20_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_20$PTA_Cmin_75 <- 100 * ave(PTA_20$DV >= 7.5, PTA_20$DAY, PTA_20$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_20$PTA_Cmin_80 <- 100 * ave(PTA_20$DV >= 80, PTA_20$DAY, PTA_20$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_20$PTA_fAUC_200 <- 100 * ave(PTA_20$fAUC >= 200, PTA_20$DAY, PTA_20$BW, FUN = mean)

# Create PTA_20_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_20_overall <- unique(PTA_20[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_20_trough, "sdtab_20_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_20_overall, "PTA_20_overall.csv",quote=F,row.names = FALSE)

```

### For dosing regimen 21

```{r dosing regimen 21 non-CRRT, warning=FALSE}
library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")

# Read in sdtab_stand.txt file
sdtab_21_noCRRT <- read.table("sdtab_21_noCRRT.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_21_noCRRT[] <- lapply(sdtab_21_noCRRT, as.numeric)

#eliminate all NAs
sdtab_21_noCRRT <- na.omit(sdtab_21_noCRRT)

# Extract only the trough events
sdtab_21_noCRRT_trough <- sdtab_21_noCRRT[sdtab_21_noCRRT$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_21_noCRRT_trough <- sdtab_21_noCRRT_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_21_noCRRT_trough<- sdtab_21_noCRRT_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_21_noCRRT_trough$fAUC<- sdtab_21_noCRRT_trough$AUC24*0.89

#Eliminate peak column
sdtab_21_noCRRT_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_21_noCRRT <- subset(sdtab_21_noCRRT_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_21_noCRRT$PTA_Cmin_75 <- 100 * ave(PTA_21_noCRRT$DV >= 7.5, PTA_21_noCRRT$DAY, PTA_21_noCRRT$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_21_noCRRT$PTA_Cmin_80 <- 100 * ave(PTA_21_noCRRT$DV >= 80, PTA_21_noCRRT$DAY, PTA_21_noCRRT$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_21_noCRRT$PTA_fAUC_200 <- 100 * ave(PTA_21_noCRRT$fAUC >= 200, PTA_21_noCRRT$DAY, PTA_21_noCRRT$BW, FUN = mean)

# Create PTA_21_noCRRT_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_21_noCRRT_overall <- unique(PTA_21_noCRRT[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_21_noCRRT_trough, "sdtab_21_noCRRT_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_21_noCRRT_overall, "PTA_21_noCRRT_overall.csv",quote=F,row.names = FALSE)

```

### Population-level simulations 250523

```{r for optimised dosing, warning=FALSE}

library(dplyr)
# Setwd for this chunk
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Population_Simulations")

# Read in sdtab_stand.txt file
sdtab_pop_10 <- read.table("sdtab_pop_10.txt", header=TRUE, skip=1, sep="", na.strings="", strip.white=TRUE)

#change all the variables to numeric
sdtab_pop_10[] <- lapply(sdtab_pop_10, as.numeric)

#eliminate all NAs
sdtab_pop_10 <- na.omit(sdtab_pop_10)

# Extract only the trough events
sdtab_pop_10_trough <- sdtab_pop_10[sdtab_pop_10$TROUGH == 1,]

# Create a new variable AUC24 for each ID
sdtab_pop_10_trough <- sdtab_pop_10_trough %>% group_by(ID) %>% mutate(AUC24 = AUC2 - lag(AUC2, default = AUC2[1]))%>%ungroup()
sdtab_pop_10_trough<- sdtab_pop_10_trough %>% mutate(AUC24 = ifelse(DAY == "1", AUC2,AUC24))

# Create a new variable fAUC, which equals AUC24*89 (we assume protein binding is 11%)
sdtab_pop_10_trough$fAUC<- sdtab_pop_10_trough$AUC24*0.89

#Eliminate peak column
sdtab_pop_10_trough$PEAK<-NULL

# Extract ID, DV, fAUC, DAY, and BW columns
PTA_pop_10 <- subset(sdtab_pop_10_trough, select = c("ID", "DV", "fAUC","CRRT", "DAY", "BW"))

# Calculate percentage of DV >= 7.5 per DAY per BW (PTA_Cmin_75)
PTA_pop_10$PTA_Cmin_75 <- 100 * ave(PTA_pop_10$DV >= 7.5, PTA_pop_10$DAY, PTA_pop_10$BW, FUN = mean)

# Calculate percentage of DV >= 80 per DAY per BW (PTA_Cmin_80)
PTA_pop_10$PTA_Cmin_80 <- 100 * ave(PTA_pop_10$DV >= 80, PTA_pop_10$DAY, PTA_pop_10$BW, FUN = mean)

# Calculate percentage of fAUC >= 200 per DAY per BW (PTA_fAUC_200)
PTA_pop_10$PTA_fAUC_200 <- 100 * ave(PTA_pop_10$fAUC >= 200, PTA_pop_10$DAY, PTA_pop_10$BW, FUN = mean)

# Create PTA_pop_10_overall dataset with unique values of PTA_Cmin, PTA_fAUC, DAY, and BW
PTA_pop_10_overall <- unique(PTA_pop_10[c("PTA_Cmin_75","PTA_Cmin_80", "PTA_fAUC_200", "DAY", "BW","CRRT")])

# Export trough and PTA dataset
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(sdtab_pop_10_trough, "sdtab_pop_10_trough.csv",quote=F,row.names = FALSE)
write.csv(PTA_pop_10_overall, "PTA_pop_10_overall.csv",quote=F,row.names = FALSE)

```

```{r read those exported datasets again when R aborted, warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
sdtab_pop_10_trough<-read.csv("sdtab_pop_10_trough.csv")

```

### Make a line plot of PTA vs BW of all regimens

#### I will denote standard regimen as regimen number 1, and increases to 9 with dosing regimen no 8

```{r create a new dosing regimen column for all dataset}
PTA_std_overall$Regimen<-1
PTA_std_noCRRT_overall$Regimen<-1
PTA_01_overall$Regimen<-2
PTA_01_noCRRT_overall$Regimen<-2
PTA_02_overall$Regimen<-3
PTA_02_noCRRT_overall$Regimen<-3
PTA_03_overall$Regimen<-4
PTA_03_noCRRT_overall$Regimen<-4
PTA_04_overall$Regimen<-5
PTA_04_noCRRT_overall$Regimen<-5
PTA_05_overall$Regimen<-6
PTA_05_noCRRT_overall$Regimen<-6
PTA_06_overall$Regimen<-7
PTA_06_noCRRT_overall$Regimen<-7
PTA_07_overall$Regimen<-8
PTA_07_noCRRT_overall$Regimen<-8
PTA_08_overall$Regimen<-9
PTA_08_noCRRT_overall$Regimen<-9
PTA_09_overall$Regimen<-10
PTA_10_overall$Regimen<-11
PTA_11_overall$Regimen<-12
PTA_12_overall$Regimen<-13
PTA_13_overall$Regimen<-14
PTA_14_overall$Regimen<-15
PTA_14_noCRRT_overall$Regimen<-15
PTA_15_overall$Regimen<-16
PTA_15_noCRRT_overall$Regimen<-16
PTA_16_overall$Regimen<-17
PTA_17_noCRRT_overall$Regimen<-18
PTA_18_overall$Regimen<-19
PTA_19_noCRRT_overall$Regimen<-20
PTA_20_overall$Regimen<-21
PTA_21_noCRRT_overall$Regimen<-22

```

```{r combine all of them into 1 single dataset used for plotting}
PTA_overall<-rbind(PTA_std_overall, PTA_std_noCRRT_overall, PTA_01_overall, PTA_01_noCRRT_overall, PTA_02_overall, PTA_02_noCRRT_overall, PTA_03_overall, PTA_03_noCRRT_overall,PTA_04_overall,PTA_04_noCRRT_overall, PTA_05_overall, PTA_05_noCRRT_overall, PTA_06_overall, PTA_06_noCRRT_overall,PTA_07_overall, PTA_07_noCRRT_overall, PTA_08_overall, PTA_08_noCRRT_overall,PTA_09_overall,PTA_10_overall,PTA_11_overall,PTA_12_overall,PTA_13_overall,PTA_14_overall,PTA_14_noCRRT_overall,PTA_15_overall,PTA_15_noCRRT_overall,PTA_16_overall,PTA_17_noCRRT_overall,PTA_18_overall,PTA_19_noCRRT_overall,PTA_20_overall,PTA_21_noCRRT_overall)
PTA_overall$Regimen<-as.factor(PTA_overall$Regimen)
PTA_overall$CRRT<-as.factor(PTA_overall$CRRT)
```

```{r adding 3 new optimised dataset to the PTA_overall}
PTA_09_overall$Regimen<-as.factor(PTA_09_overall$Regimen)
PTA_09_overall$CRRT<-as.factor(PTA_09_overall$CRRT)
PTA_10_overall$Regimen<-as.factor(PTA_10_overall$Regimen)
PTA_10_overall$CRRT<-as.factor(PTA_10_overall$CRRT)
PTA_11_overall$Regimen<-as.factor(PTA_11_overall$Regimen)
PTA_11_overall$CRRT<-as.factor(PTA_11_overall$CRRT)
PTA_overall<-rbind(PTA_overall,PTA_09_overall,PTA_10_overall,PTA_11_overall)
PTA_overall<-rbind(PTA_overall,PTA_14_overall,PTA_14_noCRRT_overall,PTA_15_overall,PTA_15_noCRRT_overall,PTA_16_overall,PTA_17_noCRRT_overall,PTA_18_overall,PTA_19_noCRRT_overall)

```

```{r combine 3 latter optimised regimens for non-CRRT patients}
PTA_optimised_noCRRT<-rbind(PTA_11_overall,PTA_12_overall,PTA_13_overall)
PTA_optimised_noCRRT$Regimen<-as.factor(PTA_optimised_noCRRT$Regimen)
PTA_optimised_noCRRT$CRRT<-as.factor(PTA_optimised_noCRRT$CRRT)
```

```{r read necessary .csv files, warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
PTA_overall<-read.csv("PTA_overall.csv")
PTA_14_overall<-read.csv("PTA_14_overall.csv")
PTA_14_noCRRT_overall<-read.csv("PTA_14_noCRRT_overall.csv")
PTA_15_overall<-read.csv("PTA_15_overall.csv")
PTA_15_noCRRT_overall<-read.csv("PTA_15_noCRRT_overall.csv")
PTA_std_overall<-read.csv("PTA_std_overall.csv")
PTA_std_noCRRT_overall<-read.csv("PTA_std_noCRRT_overall.csv")
PTA_01_overall<-read.csv("PTA_01_overall.csv")
PTA_01_noCRRT_overall<-read.csv("PTA_01_noCRRT_overall.csv")
PTA_02_overall<-read.csv("PTA_02_overall.csv")
PTA_02_noCRRT_overall<-read.csv("PTA_02_noCRRT_overall.csv")
PTA_03_overall<-read.csv("PTA_03_overall.csv")
PTA_03_noCRRT_overall<-read.csv("PTA_03_noCRRT_overall.csv")
PTA_04_overall<-read.csv("PTA_04_overall.csv")
PTA_04_noCRRT_overall<-read.csv("PTA_04_noCRRT_overall.csv")
PTA_05_overall<-read.csv("PTA_05_overall.csv")
PTA_05_noCRRT_overall<-read.csv("PTA_05_noCRRT_overall.csv")
PTA_06_overall<-read.csv("PTA_06_overall.csv")
PTA_06_noCRRT_overall<-read.csv("PTA_06_noCRRT_overall.csv")
PTA_07_overall<-read.csv("PTA_07_overall.csv")
PTA_07_noCRRT_overall<-read.csv("PTA_07_noCRRT_overall.csv")
PTA_08_overall<-read.csv("PTA_08_overall.csv")
PTA_08_noCRRT_overall<-read.csv("PTA_08_noCRRT_overall.csv")
PTA_09_overall<-read.csv("PTA_09_overall.csv")
PTA_10_overall<-read.csv("PTA_10_overall.csv")
PTA_11_overall<-read.csv("PTA_11_overall.csv")
PTA_12_overall<-read.csv("PTA_12_overall.csv")
PTA_13_overall<-read.csv("PTA_13_overall.csv")
PTA_16_overall<-read.csv("PTA_16_overall.csv")
PTA_17_noCRRT_overall<-read.csv("PTA_17_noCRRT_overall.csv")
PTA_18_overall<-read.csv("PTA_18_overall.csv")
PTA_19_noCRRT_overall<-read.csv("PTA_19_noCRRT_overall.csv")
```

```{r export PTA_overall again}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
write.csv(PTA_overall, "PTA_overall.csv",quote=F,row.names = FALSE)
```


##### Here is when I only select the 24-hour trough of dosing_regimen4 (after meeting with Erwin 160523)
```{r adding the new trough dataset of regimen 4}
PTA_04_overall$Regimen<-as.factor(PTA_04_overall$Regimen)
PTA_04_overall$CRRT<-as.factor(PTA_04_overall$CRRT)
PTA_04_noCRRT_overall$Regimen<-as.factor(PTA_04_noCRRT_overall$Regimen)
PTA_04_noCRRT_overall$CRRT<-as.factor(PTA_04_noCRRT_overall$CRRT)
PTA_overall <- PTA_overall[PTA_overall$Regimen != 5, ]
PTA_overall<-rbind(PTA_overall,PTA_04_overall,PTA_04_noCRRT_overall)
```


#### Then save Trough_overall and PTA_overall dataset for future usage
```{r export trough and pta overall datasets}
Trough_overall<-rbind(standard_dosing_trough, standard_dosing_noCRRT_trough,sdtab_01_trough,sdtab_01_noCRRT_trough,sdtab_02_trough,sdtab_02_noCRRT_trough,sdtab_03_trough,sdtab_03_noCRRT_trough,sdtab_04_trough,sdtab_04_noCRRT_trough,sdtab_05_trough,sdtab_05_noCRRT_trough,sdtab_06_trough,sdtab_06_noCRRT_trough,sdtab_07_trough,sdtab_07_noCRRT_trough,sdtab_08_trough,sdtab_08_noCRRT_trough,sdtab_09_trough,sdtab_10_trough,sdtab_11_trough)
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")
write.csv(Trough_overall, "Trough_overall.csv",quote=F,row.names = FALSE)
write.csv(PTA_overall, "PTA_overall.csv",quote=F,row.names = FALSE)
```

#### After that, whenever I need it, just read it here
```{r read trough_overall and PTA_overall dataset}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")
PTA_overall<-read.csv("PTA_overall.csv")
Trough_overall<-read.csv("Trough_overall.csv")
```


#### Then I make line plots of PTA Cmin of 7.5 per day of all regimens 

##### Day 1
```{r PTA Cmin 7.5 mg/L day 1 CRRT patients}
library(dplyr)
library(ggplot2)
PTA_CRRT75_DAY1<-PTA_overall %>%
  filter(CRRT == 1, DAY == 1, as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT75_DAY1
```

```{r PTA Cmin 7.5 mg/L day 1 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT75_DAY1<-PTA_overall %>%
  filter(CRRT == 0, DAY == 1, as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT75_DAY1
```

##### Day 2
```{r PTA Cmin 7.5 mg/L day 2 CRRT patients}
library(ggplot2)
PTA_CRRT75_DAY2<-PTA_overall %>%
  filter(CRRT==1, DAY==2,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT75_DAY2
```

```{r PTA Cmin 7.5 mg/L day 2 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT75_DAY2<-PTA_overall %>%
  filter(CRRT==0, DAY==2,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT75_DAY2
```

##### Day 7
```{r PTA Cmin 7.5 mg/L day 7 CRRT patients}
library(ggplot2)
PTA_CRRT75_DAY7<-PTA_overall %>%
  filter(CRRT==1, DAY==7,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT75_DAY7
```

```{r PTA Cmin 7.5 mg/L day 7 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT75_DAY7<-PTA_overall %>%
  filter(CRRT==0, DAY==7,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT75_DAY7
```

##### Day 14
```{r PTA Cmin 7.5 mg/L day 14 CRRT patients}
library(ggplot2)
PTA_CRRT75_DAY14<-PTA_overall %>%
  filter(CRRT==1, DAY==14,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT75_DAY14
```

```{r PTA Cmin 7.5 mg/L day 14 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT75_DAY14<-PTA_overall %>%
  filter(CRRT==0, DAY==14,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_75, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 7.5 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 7.5 mg/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT75_DAY14
```

#### Then I make line plots of PTA fAUC of 200 mgxh/L per day of all regimens 

##### Day 1
```{r PTA fAUC 200 mgxh/L day 1 CRRT patients}
library(ggplot2)
PTA_CRRT200_DAY1<-PTA_overall %>%
  filter(CRRT==1, DAY==1,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_CRRT200_DAY1
```
###### Optimised regimen CRRT patients
```{r PTA fAUC 200 mgxh/L day 1 CRRT patients optimised regimen}
library(ggplot2)
library(dplyr)
PTA_CRRT200_DAY1_optimised<-PTA_overall %>%
  filter(CRRT==1, DAY==1,Regimen==10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("black"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 800 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 800 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_CRRT200_DAY1_optimised
```

```{r PTA fAUC 200 mgxh/L day 1 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT200_DAY1<-PTA_overall %>%
  filter(CRRT==0, DAY==1,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY1
```

###### Optimised regimen non-CRRT patients 01

```{r PTA fAUC 200 mgxh/L day 1 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT200_DAY1_optimised_01<-PTA_overall %>%
  filter(CRRT==0, DAY==1,Regimen==11) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=110 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >110 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY1_optimised_01
```

###### Optimised regimen non-CRRT patients 02
```{r PTA fAUC 200 mgxh/L day 1 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT200_DAY1_optimised_02<-PTA_overall %>%
  filter(CRRT==0, DAY==1,Regimen==12) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 105, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY1_optimised_02
```

###### Compare 3 optimised non-CRRT dosing

```{r PTA fAUC 200 mgxh/L day 1 non-CRRT patients}
library(ggplot2)
library(dplyr)
PTA_NOCRRT200_DAY1_optimised_03<-PTA_optimised_noCRRT %>%
  filter(DAY==1) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg", "1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 400 mg q24h - BW >90 kg","1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY1_optimised_03
```

##### Day 2
```{r PTA fAUC 200 mgxh/L day 2 CRRT patients}
library(ggplot2)
PTA_CRRT200_DAY2<-PTA_overall %>%
  filter(CRRT==1, DAY==2,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT200_DAY2
```

###### Optimised regimen
```{r PTA fAUC 200 mgxh/L day 2 CRRT patients optimised regimen}
library(ggplot2)
PTA_CRRT200_DAY2_optimised<-PTA_overall %>%
  filter(CRRT==1, DAY==2,Regimen==10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("black"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 800 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 800 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_CRRT200_DAY2_optimised
```

```{r PTA fAUC 200 mgxh/L day 2 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT200_DAY2<-PTA_overall %>%
  filter(CRRT==0, DAY==2,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY2
```

###### Optimised regimen non-CRRT patients 01
```{r PTA fAUC 200 mgxh/L day 2 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT200_DAY2_optimised_01<-PTA_overall %>%
  filter(CRRT==0, DAY==2,Regimen==11) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=110 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >110 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY2_optimised_01
```

###### Optimised regimen non-CRRT patients 02
```{r PTA fAUC 200 mgxh/L day 2 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT200_DAY2_optimised_02<-PTA_overall %>%
  filter(CRRT==0, DAY==2,Regimen==12) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 105, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY2_optimised_02
```

###### Compare 3 optimised non-CRRT dosing

```{r PTA fAUC 200 mgxh/L day 2 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT200_DAY2_optimised_03<-PTA_optimised_noCRRT %>%
  filter(DAY==2) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg", "1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 400 mg q24h - BW >90 kg","1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY2_optimised_03
```

##### Day 3
```{r PTA fAUC 200 mgxh/L day 3 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT200_DAY3<-PTA_overall %>%
  filter(CRRT==0, DAY==3,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 3") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY3
```

##### Day 7
```{r PTA fAUC 200 mgxh/L day 7 CRRT patients}
library(ggplot2)
PTA_CRRT200_DAY7<-PTA_overall %>%
  filter(CRRT==1, DAY==7,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT200_DAY7
```

###### Optimised regimen
```{r PTA fAUC 200 mgxh/L day 7 CRRT patients optimised regimen}
library(ggplot2)
PTA_CRRT200_DAY7_optimised<-PTA_overall %>%
  filter(CRRT==1, DAY==7,Regimen==10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("black"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 800 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 800 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_CRRT200_DAY7_optimised
```

```{r PTA fAUC 200 mgxh/L day 7 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT200_DAY7<-PTA_overall %>%
  filter(CRRT==0, DAY==7,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY7
```

###### Optimised regimen non-CRRT patients 01
```{r PTA fAUC 200 mgxh/L day 7 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT200_DAY7_optimised_01<-PTA_overall %>%
  filter(CRRT==0, DAY==7,Regimen==11) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=110 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >110 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY7_optimised_01
```

###### Optimised regimen non-CRRT patients 02
```{r PTA fAUC 200 mgxh/L day 7 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT200_DAY7_optimised_02<-PTA_overall %>%
  filter(CRRT==0, DAY==7,Regimen==12) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 105, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY7_optimised_02
```

###### Compare 3 optimised non-CRRT dosing

```{r PTA fAUC 200 mgxh/L day 7 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT200_DAY7_optimised_03<-PTA_optimised_noCRRT %>%
  filter(DAY==7) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg", "1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 400 mg q24h - BW >90 kg","1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY7_optimised_03
```

##### Day 14
```{r PTA fAUC 200 mgxh/L day 14 CRRT patients}
library(ggplot2)
PTA_CRRT200_DAY14<-PTA_overall %>%
  filter(CRRT==1, DAY==14,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT200_DAY14
```

###### Optimised regimen
```{r PTA fAUC 200 mgxh/L day 14 CRRT patients optimised regimen}
library(ggplot2)
PTA_CRRT200_DAY14_optimised<-PTA_overall %>%
  filter(CRRT==1, DAY==14,Regimen==10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("black"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 800 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 800 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_CRRT200_DAY14_optimised
```

```{r PTA fAUC 200 mgxh/L day 14 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT200_DAY14<-PTA_overall %>%
  filter(CRRT==0, DAY==14,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY14

```

###### Optimised regimen non-CRRT patients 01
```{r PTA fAUC 200 mgxh/L day 14 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT200_DAY14_optimised_01<-PTA_overall %>%
  filter(CRRT==0, DAY==14,Regimen==11) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=110 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >110 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY14_optimised_01

```

###### Optimised regimen non-CRRT patients 02

```{r PTA fAUC 200 mgxh/L day 14 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT200_DAY14_optimised_02<-PTA_overall %>%
  filter(CRRT==0, DAY==14,Regimen==12) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 105, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY14_optimised_02

```

###### Compare 3 optimised non-CRRT dosing

```{r PTA fAUC 200 mgxh/L day 14 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT200_DAY14_optimised_03<-PTA_optimised_noCRRT %>%
  filter(DAY==14) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg", "1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 400 mg q24h - BW >90 kg","1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT200_DAY14_optimised_03
```

#### PTA fAUC of 200 mgxh/L paper appendix 200523 

##### Day 1 to evaluate the adequacy of loading dose

```{r PTA fAUC 200 mgxh/L day 1 CRRT patients}

# This is my former version
library(ggplot2)
library(dplyr)
PTA_CRRT200_DAY1<- PTA_overall %>%
  filter(CRRT == 1, DAY == 1, Regimen %in% c(1, 2, 5, 9, 15, 16, 17, 6, 7)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 5, 9, 15, 16, 17, 6, 7))) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) + 
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_CRRT200_DAY1

# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_CRRT200_DAY1<- PTA_overall %>%
  filter(CRRT == 1, DAY == 1, Regimen %in% c(1, 2, 5, 9, 15, 16, 17, 6, 7)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 5, 9, 15, 16, 17, 6, 7))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_fAUC_200, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_fAUC_200, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) +
                scale_shape_manual(values = c(16, 17, 15, 18, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_CRRT200_DAY1


```

```{r PTA fAUC 200 mgxh/L day 1 non-CRRT patients}

library(ggplot2)
PTA_NOCRRT200_DAY1<- PTA_overall %>%
  filter(CRRT == 0, DAY == 1, Regimen %in% c(1, 2, 5, 9, 15, 16, 18, 6, 7)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 5, 9, 15, 16, 18, 6, 7))) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) + 
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) #+
        #geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY1

```

##### Day 7 to evaluate the adequacy of maintenance dose

```{r PTA fAUC 200 mgxh/L day 7 CRRT patients}
library(ggplot2)
PTA_CRRT200_DAY7<- PTA_overall %>%
  filter(CRRT == 1, DAY == 7, Regimen %in% c(1, 2, 3, 5, 8, 9, 17, 19)) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) + 
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) #+
        #geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_CRRT200_DAY7

```

```{r PTA fAUC 200 mgxh/L day 7 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT200_DAY7<- PTA_overall %>%
  filter(CRRT == 0, DAY == 7, Regimen %in% c(1, 2, 3, 5, 8, 9, 18, 20)) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) + 
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) #+
        #geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY7

```

##### Day 2 to evaluate the adequacy of loading + maintenance dose

```{r PTA fAUC 200 mgxh/L day 2 CRRT patients}
library(ggplot2)
PTA_CRRT200_DAY2<- PTA_overall %>%
  filter(CRRT == 1, DAY == 2, Regimen %in% c(1, 2, 3, 5, 8, 9, 17, 19)) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) + 
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) #+
        #geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_CRRT200_DAY2

```

```{r PTA fAUC 200 mgxh/L day 2 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT200_DAY2<- PTA_overall %>%
  filter(CRRT == 0, DAY == 2, Regimen %in% c(1, 2, 3, 5, 8, 9, 18, 20)) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) + 
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) #+
        #geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY2

```

##### Day 14 to evaluate the adequacy of maintenance dose

```{r PTA fAUC 200 mgxh/L day 14 CRRT patients}
library(ggplot2)
PTA_CRRT200_DAY14<- PTA_overall %>%
  filter(CRRT == 1, DAY == 14, Regimen %in% c(1, 2, 3, 5, 8, 9, 17, 19)) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) + 
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) #+
        #geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_CRRT200_DAY14

```

```{r PTA fAUC 200 mgxh/L day 14 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT200_DAY14<- PTA_overall %>%
  filter(CRRT == 0, DAY == 14, Regimen %in% c(1, 2, 3, 5, 8, 9, 18, 20)) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) + 
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) #+
        #geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY14

```

#### PTA fAUC of 200 mgxh/L paper appendix 240523 

```{r read in PTA_overall dataset, warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
PTA_overall<-read.csv("PTA_overall.csv")
```

##### Day 1 to evaluate the adequacy of loading dose

```{r PTA fAUC 200 mgxh/L day 1 CRRT patients, warning=FALSE}

# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_CRRT200_DAY1<- PTA_overall %>%
  filter(CRRT == 1, DAY == 1, BW<150,Regimen %in% c(1, 3, 5, 9, 23, 24, 19, 6, 7)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 3, 5, 9, 23, 24, 19, 6, 7))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_fAUC_200, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_fAUC_200, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) +
                scale_shape_manual(values = c(16, 17, 15, 18, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 1 CRRT") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 55, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 80, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 100, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 120, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_CRRT200_DAY1 #1000 55kg - 1200 80kg - 1400 100kg - 1600 120kg - 1800 rest
ggsave("PTA_CRRT200_DAY1.png", PTA_CRRT200_DAY1, dpi = 300, width = 12, height = 7)

```

```{r PTA fAUC 200 mgxh/L day 1 non-CRRT patients}

# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_NOCRRT200_DAY1<- PTA_overall %>%
  filter(CRRT == 0, DAY == 1, Regimen %in% c(1, 2, 5, 9, 15, 16, 18, 6, 7)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 5, 9, 15, 16, 18, 6, 7))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_fAUC_200, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_fAUC_200, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) +
                scale_shape_manual(values = c(16, 17, 15, 18, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 1 non-CRRT") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 55, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 80, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 100, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 120, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_NOCRRT200_DAY1 #800 55kg - 1000 80kg - 1200 80kg - 1400 120kg - 1600 rest
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/working documents")
ggsave("PTA_NOCRRT200_DAY1.png", PTA_NOCRRT200_DAY1, dpi = 300, width = 12, height = 7)

```

##### Day 7 to evaluate the adequacy of maintenance dose

```{r PTA fAUC 200 mgxh/L day 7 CRRT patients}

# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_CRRT200_DAY7<- PTA_overall %>%
  filter(CRRT == 1, DAY == 7, Regimen %in% c(1, 2, 3, 5, 8, 9, 17, 19)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 17, 19))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_fAUC_200, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_fAUC_200, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_CRRT200_DAY7

```

```{r PTA fAUC 200 mgxh/L day 7 non-CRRT patients}

# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_NOCRRT200_DAY7<- PTA_overall %>%
  filter(CRRT == 0, DAY == 7, Regimen %in% c(1, 2, 3, 5, 8, 9, 18, 20)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 18, 20))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_fAUC_200, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_fAUC_200, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_NOCRRT200_DAY7

```

##### Day 2 to evaluate the adequacy of loading + maintenance dose

```{r PTA fAUC 200 mgxh/L day 2 CRRT patients}

# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_CRRT200_DAY2<- PTA_overall %>%
  filter(CRRT == 1, DAY == 2, Regimen %in% c(1, 2, 3, 5, 8, 9, 17, 19)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 17, 19))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_fAUC_200, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_fAUC_200, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_CRRT200_DAY2

```

```{r PTA fAUC 200 mgxh/L day 2 non-CRRT patients}
# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_NOCRRT200_DAY2<- PTA_overall %>%
  filter(CRRT == 0, DAY == 2, Regimen %in% c(1, 2, 3, 5, 8, 9, 18, 20)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 18, 20))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_fAUC_200, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_fAUC_200, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_NOCRRT200_DAY2

```

##### Day 14 to evaluate the adequacy of maintenance dose

```{r PTA fAUC 200 mgxh/L day 14 CRRT patients}
# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_CRRT200_DAY14<- PTA_overall %>%
  filter(CRRT == 1, DAY == 14, Regimen %in% c(1, 2, 3, 5, 8, 9, 17, 19)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 17, 19))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_fAUC_200, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_fAUC_200, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 14") +
  theme(legend.position = "right") +
   theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_CRRT200_DAY14
```

```{r PTA fAUC 200 mgxh/L day 14 non-CRRT patients}
# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_NOCRRT200_DAY14<- PTA_overall %>%
  filter(CRRT == 0, DAY == 14, Regimen %in% c(1, 2, 3, 5, 8, 9, 18, 20)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 18, 20))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_fAUC_200, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_fAUC_200, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 14") +
  theme(legend.position = "right") +
 theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_NOCRRT200_DAY14

```

##### Panels PTA over time of CRRT and non-CRRT patients

```{r PTA day 1 7 2 14 fAUC200 CRRT patients, warning=FALSE}
#This plot is in the appendix
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Manuscript_plots")
library(cowplot)

grid_tested_CRRT <- plot_grid(PTA_CRRT200_DAY1, PTA_CRRT200_DAY7, PTA_CRRT200_DAY2, PTA_CRRT200_DAY14, nrow = 2, align = "v")

title <- ggdraw() + 
  draw_label("Probability of target attainment of fAUC 200 mgxh/L", fontface = "bold", size = 12)

# Arrange the title and grid using plot_grid()
grid_tested_CRRT <- plot_grid(title, grid_tested_CRRT, ncol = 1, rel_heights = c(0.02, 1))

ggsave("grid_tested_CRRT.png", grid_tested_CRRT, dpi = 300, width = 16, height = 8.27)

```

```{r PTA day 1 7 2 14 fAUC200 non-CRRT patients, warning=FALSE}
#This plot is in the appendix
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Manuscript_plots")
library(cowplot)

grid_tested_noCRRT <- plot_grid(PTA_NOCRRT200_DAY1, PTA_NOCRRT200_DAY7, PTA_NOCRRT200_DAY2, PTA_NOCRRT200_DAY14, nrow = 2, align = "v")

title <- ggdraw() + 
  draw_label("Probability of target attainment of fAUC 200 mgxh/L", fontface = "bold", size = 12)

# Arrange the title and grid using plot_grid()
grid_tested_noCRRT <- plot_grid(title, grid_tested_noCRRT, ncol = 1, rel_heights = c(0.02, 1))

ggsave("grid_tested_noCRRT.png", grid_tested_noCRRT, dpi = 300, width = 16, height = 8.27)

```

#### PTA Cmin of 80 mgxh/L paper appendix 240523

```{r read in PTA_overall dataset, warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Trough and PTA datasets")
PTA_overall<-read.csv("PTA_overall.csv")
```

##### Day 1 to evaluate the toxicity of loading dose

```{r PTA Cmin 80 mg/L day 1 CRRT patients, warning=FALSE}

# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_CRRT80_DAY1<- PTA_overall %>%
  filter(CRRT == 1, DAY == 1, Regimen %in% c(1, 2, 5, 9, 15, 16, 17, 6, 7)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 5, 9, 15, 16, 17, 6, 7))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_Cmin_80, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_Cmin_80, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) +
                scale_shape_manual(values = c(16, 17, 15, 18, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_CRRT80_DAY1


```

```{r PTA Cmin 80 mg/L day 1 non-CRRT patients}

# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_NOCRRT80_DAY1<- PTA_overall %>%
  filter(CRRT == 0, DAY == 1, Regimen %in% c(1, 2, 5, 9, 15, 16, 18, 6, 7)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 5, 9, 15, 16, 18, 6, 7))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_Cmin_80, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_Cmin_80, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) +
                scale_shape_manual(values = c(16, 17, 15, 18, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_NOCRRT80_DAY1

```

##### Day 7 to evaluate the toxicity of maintenance dose

```{r PTA Cmin 80 mg/L day 7 CRRT patients}

# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_CRRT80_DAY7<- PTA_overall %>%
  filter(CRRT == 1, DAY == 7, Regimen %in% c(1, 2, 3, 5, 8, 9, 17, 19)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 17, 19))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_Cmin_80, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_Cmin_80, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_CRRT80_DAY7

```

```{r PTA Cmin 80 mg/L day 7 non-CRRT patients}

# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_NOCRRT80_DAY7<- PTA_overall %>%
  filter(CRRT == 0, DAY == 7, Regimen %in% c(1, 2, 3, 5, 8, 9, 18, 20)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 18, 20))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_Cmin_80, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_Cmin_80, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_NOCRRT80_DAY7

```

##### Day 2 to evaluate the toxicity of loading + maintenance dose

```{r PTA Cmin 80 mgxh/L day 2 CRRT patients}

# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_CRRT80_DAY2<- PTA_overall %>%
  filter(CRRT == 1, DAY == 2, Regimen %in% c(1, 2, 3, 5, 8, 9, 17, 19)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 17, 19))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_Cmin_80, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_Cmin_80, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_CRRT80_DAY2

```

```{r PTA Cmin 80 mg/L day 2 non-CRRT patients}
# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_NOCRRT80_DAY2<- PTA_overall %>%
  filter(CRRT == 0, DAY == 2, Regimen %in% c(1, 2, 3, 5, 8, 9, 18, 20)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 18, 20))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_Cmin_80, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_Cmin_80, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_NOCRRT80_DAY2

```

##### Day 14 to evaluate the toxicity of maintenance dose

```{r PTA Cmin 80 mg/L day 14 CRRT patients}
# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_CRRT80_DAY14<- PTA_overall %>%
  filter(CRRT == 1, DAY == 14, Regimen %in% c(1, 2, 3, 5, 8, 9, 17, 19)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 17, 19))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_Cmin_80, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_Cmin_80, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 600 mg  q24h", "1800 mg q24h (day 1) / 800 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 14") +
  theme(legend.position = "right") +
   theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_CRRT80_DAY14
```

```{r PTA Cmin 80 mg/L day 14 non-CRRT patients}
# This version is better for black&white printing
library(ggplot2)
library(dplyr)
PTA_NOCRRT80_DAY14<- PTA_overall %>%
  filter(CRRT == 0, DAY == 14, Regimen %in% c(1, 2, 3, 5, 8, 9, 18, 20)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 3, 5, 8, 9, 18, 20))) %>%
  ggplot() +  geom_line(aes(x = BW, y = PTA_Cmin_80, color = factor(Regimen)),size = 1) + 
        geom_point(aes(x = BW, y = PTA_Cmin_80, shape = factor(Regimen)), size = 2) + 
        scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
                scale_shape_manual(values = c(16, 17, 15, 25, 22, 8, 2, 5),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1) / 400 mg q24h", "1000 mg q24h (day 1) / 600 mg q24h", "1000 mg q24h (day 1) / 800 mg q24h",
                                "800 mg first 12h / 400 mg q12h", "1200 mg q24h (day 1) / 600 mg q24h","1200 mg q24h (day 1) / 800 mg q24h",
                                "1800 mg q24h (day 1) / 200 mg  q24h", "1800 mg q24h (day 1) / 400 mg q24h")) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("Day 14") +
  theme(legend.position = "right") +
 theme(plot.title = element_text(hjust = 0.5, size = 10,face="bold"),
        axis.title = element_text(size = 9),legend.title = element_text(size = 9),
        axis.text = element_text(size = 9),
        legend.text = element_text(size = 8),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        guides(shape = guide_legend(title = "Dosing regimen"), color = guide_legend(title = "Dosing regimen"))
PTA_NOCRRT80_DAY14

```

##### Panels toixcity over time of CRRT and non-CRRT patients

```{r PTA day 1 7 2 14 Cmin80 CRRT patients, warning=FALSE}
#This plot is in the appendix
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Manuscript_plots")
library(cowplot)

grid_tox_CRRT <- plot_grid(PTA_CRRT80_DAY1, PTA_CRRT80_DAY7, PTA_CRRT80_DAY2, PTA_CRRT80_DAY14, nrow = 2, align = "v")

title <- ggdraw() + 
  draw_label("Probability of reaching toxicity threshold of Cmin 80 mg/L", fontface = "bold", size = 12)

# Arrange the title and grid using plot_grid()
grid_tox_CRRT <- plot_grid(title, grid_tox_CRRT, ncol = 1, rel_heights = c(0.02, 1))

ggsave("grid_tox_CRRT.png", grid_tox_CRRT, dpi = 300, width = 16, height = 8.27)

```

```{r PTA day 1 7 2 14 Cmin80 non-CRRT patients, warning=FALSE}
#This plot is in the appendix
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/Manuscript_plots")
library(cowplot)

grid_tox_noCRRT <- plot_grid(PTA_NOCRRT80_DAY1, PTA_NOCRRT80_DAY7, PTA_NOCRRT80_DAY2, PTA_NOCRRT80_DAY14, nrow = 2, align = "v")

title <- ggdraw() + 
  draw_label("Probability of reaching toxicity threshold of Cmin 80 mg/L", fontface = "bold", size = 12)

# Arrange the title and grid using plot_grid()
grid_tox_noCRRT <- plot_grid(title, grid_tox_noCRRT, ncol = 1, rel_heights = c(0.02, 1))

ggsave("grid_tox_noCRRT.png", grid_tox_noCRRT, dpi = 300, width = 16, height = 8.27)

```

#### PTA Cmin of 80 mgxh/L paper appendix 200523 

##### Day 1 to evaluate the adequacy of loading dose

```{r PTA fAUC 200 mgxh/L day 1 CRRT patients}

library(ggplot2)
PTA_CRRT200_DAY1<- PTA_overall %>%
  filter(CRRT == 1, DAY == 1, Regimen %in% c(1, 2, 5, 9, 15, 16, 17, 6, 7)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 5, 9, 15, 16, 17, 6, 7))) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) + 
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) #+
        #geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_CRRT200_DAY1

```

```{r PTA fAUC 200 mgxh/L day 1 non-CRRT patients}

library(ggplot2)
PTA_NOCRRT200_DAY1<- PTA_overall %>%
  filter(CRRT == 0, DAY == 1, Regimen %in% c(1, 2, 5, 9, 15, 16, 18, 6, 7)) %>%
  mutate(Regimen = factor(Regimen, levels = c(1, 2, 5, 9, 15, 16, 18, 6, 7))) %>%
  ggplot(aes(x = BW, y = PTA_fAUC_200, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of fAUC of 200 mgxh/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of fAUC 200 mgxh/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)", "1000 mg q24h (day 1)",
                                "800 mg + 400 mg q12h (day 1)", "1200 mg q24h (day 1)","1400 mg q24h (day 1)","1600 mg q24h (day 1)",
                                "1800 mg q24h (day 1)","12 mg/kg q24h (day 1)","18 mg/kg q24h (day 1)")) + 
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) #+
        #geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT200_DAY1

```

#### Then I make line plots of PTA Cmin of 80 mg/L per day of all regimens 
##### Day 1
```{r PTA Cmin 80 mg/L day 1 CRRT patients}
library(ggplot2)
PTA_CRRT80_DAY1<-PTA_overall %>%
  filter(CRRT==1, DAY==1,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY1

```

###### Optimised regimen CRRT patients

```{r PTA Cmin 80 mg/L day 1 CRRT patients optimised dosing}
library(ggplot2)
PTA_CRRT80_DAY1_optimised<-PTA_overall %>%
  filter(CRRT==1, DAY==1,Regimen==10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
 scale_color_manual(values = c("black"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 800 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 800 mg q24h - BW >90 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY1_optimised

```

###### No toxicity on Day 1

```{r PTA Cmin 80 mg/L day 1 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT80_DAY1<-PTA_overall %>%
  filter(CRRT==0, DAY==1,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)",
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) #+
#geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY1
```

###### Optimised regimen non-CRRT patients 01
```{r PTA Cmin 80mg/L day 1 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT80_DAY1_optimised_01<-PTA_overall %>%
  filter(CRRT==0, DAY==1,Regimen==11) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=110 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >110 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        #geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT80_DAY1_optimised_01
```

###### Optimised regimen non-CRRT patients 02
```{r PTA Cmin 80mg/L day 1 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT80_DAY1_optimised_02<-PTA_overall %>%
  filter(CRRT==0, DAY==1,Regimen==12) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        #geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT80_DAY1_optimised_02
```

###### Compare 3 optimised non-CRRT dosing

```{r PTA Cmin 80 mg/L day 1 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT80_DAY1_optimised_03<-PTA_optimised_noCRRT %>%
  filter(DAY==1) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 1") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg", "1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 400 mg q24h - BW >90 kg","1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY1_optimised_03
```

###### No toxicity Day 1

##### Day 2
```{r PTA Cmin 80 mg/L day 2 CRRT patients}
library(ggplot2)
PTA_CRRT80_DAY2<-PTA_overall %>%
  filter(CRRT==1, DAY==2,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY2
```

###### No toxicity Day 2

###### Optimised regimen CRRT patients
```{r PTA Cmin 80 mg/L day 2 CRRT patients optimised dosing}
library(ggplot2)
PTA_CRRT80_DAY2_optimised<-PTA_overall %>%
  filter(CRRT==1, DAY==2,Regimen==10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
 scale_color_manual(values = c("black"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 800 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 800 mg q24h - BW >90 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY2_optimised

```

```{r PTA Cmin 80 mg/L day 2 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT80_DAY2<-PTA_overall %>%
  filter(CRRT==0, DAY==2,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) #+
#geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY2
```

###### Optimised regimen non-CRRT patients 01
```{r PTA Cmin 80mg/L day 2 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT80_DAY2_optimised_01<-PTA_overall %>%
  filter(CRRT==0, DAY==2,Regimen==11) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=110 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >110 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        #geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT80_DAY2_optimised_01
```

###### Optimised regimen non-CRRT patients 02
```{r PTA Cmin 80mg/L day 2 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT80_DAY2_optimised_02<-PTA_overall %>%
  filter(CRRT==0, DAY==2,Regimen==12) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        #geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT80_DAY2_optimised_02
```

###### Compare 3 optimised non-CRRT dosing

```{r PTA Cmin 80 mg/L day 2 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT80_DAY2_optimised_03<-PTA_optimised_noCRRT %>%
  filter(DAY==2) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 2") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg", "1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 400 mg q24h - BW >90 kg","1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY2_optimised_03
```

###### Very small toxicity Day 2

##### Day 7
```{r PTA Cmin 80 mg/L day 7 CRRT patients}
library(ggplot2)
PTA_CRRT80_DAY7<-PTA_overall %>%
  filter(CRRT==1, DAY==7,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY7
```

###### Optimised regimen CRRT patients
```{r PTA Cmin 80 mg/L day 7 CRRT patients optimised dosing}
library(ggplot2)
PTA_CRRT80_DAY7_optimised<-PTA_overall %>%
  filter(CRRT==1, DAY==7,Regimen==10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
 scale_color_manual(values = c("black"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 800 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 800 mg q24h - BW >90 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY7_optimised

```

###### No toxicity Day 7

```{r PTA Cmin 80 mg/L day 7 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT80_DAY7<-PTA_overall %>%
  filter(CRRT==0, DAY==7,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) #+
         #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY7
```

###### Compare 3 optimised non-CRRT dosing

```{r PTA Cmin 80 mg/L day 7 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT80_DAY7_optimised_03<-PTA_optimised_noCRRT %>%
  filter(DAY==7) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg", "1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 400 mg q24h - BW >90 kg","1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY7_optimised_03
```

###### Optimised regimen non-CRRT patients 01
```{r PTA Cmin 80mg/L day 7 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT80_DAY7_optimised_01<-PTA_overall %>%
  filter(CRRT==0, DAY==7,Regimen==11) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=110 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >110 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        #geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT80_DAY7_optimised_01
```

###### Optimised regimen non-CRRT patients 02
```{r PTA Cmin 80mg/L day 7 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT80_DAY7_optimised_02<-PTA_overall %>%
  filter(CRRT==0, DAY==7,Regimen==12) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 7") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        #geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT80_DAY7_optimised_02
```

###### Up to 20% toxicity for non-CRRT patients on Day 7

##### Day 14
```{r PTA Cmin 80 mg/L day 14 CRRT patients}
library(ggplot2)
PTA_CRRT80_DAY14<-PTA_overall %>%
  filter(CRRT==1, DAY==14,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY14
```

###### Optimised regimen CRRT patients
```{r PTA Cmin 80 mg/L day 14 CRRT patients optimised dosing}
library(ggplot2)
PTA_CRRT80_DAY14_optimised<-PTA_overall %>%
  filter(CRRT==1, DAY==14,Regimen==10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
 scale_color_manual(values = c("black"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 800 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 800 mg q24h - BW >90 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_CRRT80_DAY14_optimised

```

###### No toxicity Day 14

```{r PTA Cmin 80 mg/L day 14 non-CRRT patients}
library(ggplot2)
 PTA_NOCRRT80_DAY14<-PTA_overall %>%
  filter(CRRT==0, DAY==14,as.numeric(as.character(Regimen)) < 10) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green", "orange", "purple", "brown", "gray","pink","black"),name = "Dosing regimen",
                     labels = c("800 mg q24h (day 1)  / 400 mg q24h", "1000 mg q24h (day 1)  / 600 mg q24h",
                                "1000 mg q24h (day 1)  / 800 mg q24h","1200 mg q24h (day 1)  / 1000 mg q24h",
                                "800 mg first 12h  / 400 mg q12h","12 mg/kg q24h (day 1)  / 6 mg/kg q24h",
                                "18 mg/kg q24h (day 1)  / 12 mg/kg q24h", "1200 mg q24h (day 1)  / 600 mg q24h",
                                "1200 mg q24h (day 1)  / 800 mg q24h")) #+
         #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY14
```

###### Up to 30% toxicity in non-CRRT patients on Day 14

###### Optimised regimen non-CRRT patients
```{r PTA Cmin 80mg/L day 14 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT80_DAY14_optimised_01<-PTA_overall %>%
  filter(CRRT==0, DAY==14,Regimen==11) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=110 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >110 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        #geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT80_DAY14_optimised_01
```

###### Optimised regimen non-CRRT patients 02
```{r PTA Cmin 80mg/L day 14 non-CRRT patients optimised regimen}
library(ggplot2)
PTA_NOCRRT80_DAY14_optimised_02<-PTA_overall %>%
  filter(CRRT==0, DAY==14,Regimen==12) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size = 1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)", 
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)", 
                     expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("blue"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg")) #+
        #geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        #geom_vline(xintercept = 110, linetype = "dashed", color = "gray50",size=1) 
PTA_NOCRRT80_DAY14_optimised_02
```

###### Compare 3 optimised non-CRRT dosing

```{r PTA Cmin 80 mg/L day 14 non-CRRT patients}
library(ggplot2)
PTA_NOCRRT80_DAY14_optimised_03<-PTA_optimised_noCRRT %>%
  filter(DAY==14) %>%
  ggplot(aes(x = BW, y = PTA_Cmin_80, color = Regimen)) +
  geom_line(size=1) +
  scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 5), name = "Body Weight (kg)" ,expand = c(0,0)) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 5), name = "Probability of Target Attainment of Cmin of 80 mg/L (%)",expand = c(0,0)) +
  theme_minimal(base_size = 12) +
        ggtitle("PTA of Cmin 80 mg/L in non-CRRT patients on Day 14") +
  theme(legend.position = "right") +
  theme(plot.title = element_text(hjust = 0.5, size = 16,face="bold"),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 12),
        panel.grid.major = element_line(colour = "gray85"),
        panel.grid.minor = element_blank()) +
  labs(color = "Regimen") +
  scale_color_manual(values = c("red", "blue", "green"),name = "Dosing regimen",
                     labels = c("1200 mg q24h (day 1) / 400 mg q24h - BW <=105 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >105 kg", "1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 400 mg q24h - BW >90 kg","1200 mg q24h (day 1) / 400 mg q24h - BW <=90 kg
2000 mg q24h (day 1) / 600 mg q24h - BW >90 kg")) +
        geom_hline(yintercept = 90, linetype = "dashed", color = "gray50",size=1) +
        geom_vline(xintercept = 90, linetype = "dashed", color = "gray50",size=1)
PTA_NOCRRT80_DAY14_optimised_03
```

#### Plot PTA of Cmin 80 of 4 days on 1 plot
```{r adjust 8 plots of PTA Cmin80}
PTA_CRRT80_DAY1_nolegend<-PTA_CRRT80_DAY1+guides(color = "none")+ theme(axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 1") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY1_nolegend<-PTA_NOCRRT80_DAY1+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 1") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_CRRT80_DAY2_nolegend<-PTA_CRRT80_DAY2+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 2") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY2_nolegend<-PTA_NOCRRT80_DAY2+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 2") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_CRRT80_DAY7_nolegend<-PTA_CRRT80_DAY7+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 7") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY7_nolegend<-PTA_NOCRRT80_DAY7+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 7") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_CRRT80_DAY14_nolegend<-PTA_CRRT80_DAY14+ theme(
        axis.text = element_text(size = 7),legend.text = element_text(size = 7), legend.title = element_text(size = 9)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 14") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY14_nolegend<-PTA_NOCRRT80_DAY14+ theme(
        axis.text = element_text(size = 7),legend.text = element_text(size = 7), legend.title = element_text(size = 9)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 14") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))
          
```

```{r save 8 plots of day 1,warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/PTAplots_testeddosing")
# Create a list of plot objects
plot_Cmin80_01 <- list(PTA_CRRT80_DAY1_nolegend, PTA_NOCRRT80_DAY1_nolegend,
                  PTA_CRRT80_DAY2_nolegend, PTA_NOCRRT80_DAY2_nolegend,
                  PTA_CRRT80_DAY7_nolegend, PTA_NOCRRT80_DAY7_nolegend)

# Define the file names
file_Cmin80_01 <- c("PTA_CRRT80_DAY1_nolegend.png", "PTA_NOCRRT80_DAY1_nolegend.png",
                "PTA_CRRT80_DAY2_nolegend.png", "PTA_NOCRRT80_DAY2_nolegend.png",
                "PTA_CRRT80_DAY7_nolegend.png", "PTA_NOCRRT80_DAY7_nolegend.png")


plot_Cmin80_02 <- list(PTA_CRRT80_DAY14_nolegend, PTA_NOCRRT80_DAY14_nolegend)

file_Cmin80_02 <- c("PTA_CRRT80_DAY14_nolegend.png", "PTA_NOCRRT80_DAY14_nolegend.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_Cmin80_01)) {
  ggsave(file_Cmin80_01[i], plot = plot_Cmin80_01[[i]], dpi = 300, width = 2.7, height = 6)
}

for (i in seq_along(plot_Cmin80_02)) {
  ggsave(file_Cmin80_02[i], plot = plot_Cmin80_02[[i]], dpi = 300, width = 5.2, height = 6)
}
```

#### Plots for optimised dosing regimens 150523

##### Firstly, for PTA 200

```{r adjust 12 plots of PTA fAUC200 optimised dosing}
PTA_CRRT200_DAY1_optimised_nolegend<-PTA_CRRT200_DAY1_optimised+guides(color = "none")+ theme(axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 1") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT200_DAY1_optimised_01_nolegend<-PTA_NOCRRT200_DAY1_optimised_01+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 1") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT200_DAY1_optimised_02_nolegend<-PTA_NOCRRT200_DAY1_optimised_02+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 1") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_CRRT200_DAY2_optimised_nolegend<-PTA_CRRT200_DAY2_optimised+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 2") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT200_DAY2_optimised_01_nolegend<-PTA_NOCRRT200_DAY2_optimised_01+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 2") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT200_DAY2_optimised_02_nolegend<-PTA_NOCRRT200_DAY2_optimised_02+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 2") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_CRRT200_DAY7_optimised_nolegend<-PTA_CRRT200_DAY7_optimised+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 7") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT200_DAY7_optimised_01_nolegend<-PTA_NOCRRT200_DAY7_optimised_01+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 7") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT200_DAY7_optimised_02_nolegend<-PTA_NOCRRT200_DAY7_optimised_02+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 7") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_CRRT200_DAY14_optimised_nolegend<-PTA_CRRT200_DAY14_optimised+ theme(
        axis.text = element_text(size = 7),legend.text = element_text(size = 7), legend.title = element_text(size = 9)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 14") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT200_DAY14_optimised_01_nolegend<-PTA_NOCRRT200_DAY14_optimised_01+ theme(
        axis.text = element_text(size = 7),legend.text = element_text(size = 7), legend.title = element_text(size = 9)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 14") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT200_DAY14_optimised_02_nolegend<-PTA_NOCRRT200_DAY14_optimised_02+ theme(
        axis.text = element_text(size = 7),legend.text = element_text(size = 7), legend.title = element_text(size = 9)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 14") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))
          
```

```{r save 12 PTA plots of optimised dosing,warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")
# Create a list of plot objects
plot_fAUC200_01 <- list(PTA_CRRT200_DAY1_optimised_nolegend, PTA_NOCRRT200_DAY1_optimised_01_nolegend,
                  PTA_NOCRRT200_DAY1_optimised_02_nolegend, PTA_CRRT200_DAY2_optimised_nolegend, PTA_NOCRRT200_DAY2_optimised_01_nolegend,PTA_NOCRRT200_DAY2_optimised_02_nolegend,PTA_CRRT200_DAY7_optimised_nolegend, PTA_NOCRRT200_DAY7_optimised_01_nolegend,PTA_NOCRRT200_DAY7_optimised_02_nolegend)

# Define the file names
file_fAUC200_01 <- c("PTA_CRRT200_DAY1_optimised_nolegend.png","PTA_NOCRRT200_DAY1_optimised_01_nolegend.png","PTA_NOCRRT200_DAY1_optimised_02_nolegend.png","PTA_CRRT200_DAY2_optimised_nolegend.png","PTA_NOCRRT200_DAY2_optimised_01_nolegend.png","PTA_NOCRRT200_DAY2_optimised_02_nolegend.png","PTA_CRRT200_DAY7_optimised_nolegend.png","PTA_NOCRRT200_DAY7_optimised_01_nolegend.png","PTA_NOCRRT200_DAY7_optimised_02_nolegend.png")


plot_fAUC200_02 <- list(PTA_CRRT200_DAY14_optimised_nolegend,PTA_NOCRRT200_DAY14_optimised_01_nolegend,PTA_NOCRRT200_DAY14_optimised_02_nolegend)

file_fAUC200_02 <- c("PTA_CRRT200_DAY14_optimised_nolegend.png","PTA_NOCRRT200_DAY14_optimised_01_nolegend.png","PTA_NOCRRT200_DAY14_optimised_02_nolegend.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_fAUC200_01)) {
  ggsave(file_fAUC200_01[i], plot = plot_fAUC200_01[[i]], dpi = 300, width = 2.7, height = 6)
}

for (i in seq_along(plot_fAUC200_02)) {
  ggsave(file_fAUC200_02[i], plot = plot_fAUC200_02[[i]], dpi = 300, width = 5.2, height = 6)
}
```

##### Secondly, for Cmin 80

```{r adjust 12 plots of PTA Cmin80 optimised dosing}
PTA_CRRT80_DAY1_optimised_nolegend<-PTA_CRRT80_DAY1_optimised+guides(color = "none")+ theme(axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 1") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY1_optimised_01_nolegend<-PTA_NOCRRT80_DAY1_optimised_01+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 1") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY1_optimised_02_nolegend<-PTA_NOCRRT80_DAY1_optimised_02+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 1") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_CRRT80_DAY2_optimised_nolegend<-PTA_CRRT80_DAY2_optimised+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 2") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY2_optimised_01_nolegend<-PTA_NOCRRT80_DAY2_optimised_01+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 2") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY2_optimised_02_nolegend<-PTA_NOCRRT80_DAY2_optimised_02+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 2") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_CRRT80_DAY7_optimised_nolegend<-PTA_CRRT80_DAY7_optimised+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 7") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY7_optimised_01_nolegend<-PTA_NOCRRT80_DAY7_optimised_01+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 7") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY7_optimised_02_nolegend<-PTA_NOCRRT80_DAY7_optimised_02+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 7") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_CRRT80_DAY14_optimised_nolegend<-PTA_CRRT80_DAY14_optimised+ theme(
        axis.text = element_text(size = 7),legend.text = element_text(size = 7), legend.title = element_text(size = 9)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 14") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY14_optimised_01_nolegend<-PTA_NOCRRT80_DAY14_optimised_01+ theme(
        axis.text = element_text(size = 7),legend.text = element_text(size = 7), legend.title = element_text(size = 9)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 14") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY14_optimised_02_nolegend<-PTA_NOCRRT80_DAY14_optimised_02+ theme(
        axis.text = element_text(size = 7),legend.text = element_text(size = 7), legend.title = element_text(size = 9)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 14") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))
          
```

```{r save 12 PTA plots of optimised dosing,warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations")
# Create a list of plot objects
plot_Cmin80_01 <- list(PTA_CRRT80_DAY1_optimised_nolegend, PTA_NOCRRT80_DAY1_optimised_01_nolegend,
                  PTA_NOCRRT80_DAY1_optimised_02_nolegend, PTA_CRRT80_DAY2_optimised_nolegend, PTA_NOCRRT80_DAY2_optimised_01_nolegend,PTA_NOCRRT80_DAY2_optimised_02_nolegend,PTA_CRRT80_DAY7_optimised_nolegend, PTA_NOCRRT80_DAY7_optimised_01_nolegend,PTA_NOCRRT80_DAY7_optimised_02_nolegend)

# Define the file names
file_Cmin80_01 <- c("PTA_CRRT80_DAY1_optimised_nolegend.png","PTA_NOCRRT80_DAY1_optimised_01_nolegend.png","PTA_NOCRRT80_DAY1_optimised_02_nolegend.png","PTA_CRRT80_DAY2_optimised_nolegend.png","PTA_NOCRRT80_DAY2_optimised_01_nolegend.png","PTA_NOCRRT80_DAY2_optimised_02_nolegend.png","PTA_CRRT80_DAY7_optimised_nolegend.png","PTA_NOCRRT80_DAY7_optimised_01_nolegend.png","PTA_NOCRRT80_DAY7_optimised_02_nolegend.png")


plot_Cmin80_02 <- list(PTA_CRRT80_DAY14_optimised_nolegend,PTA_NOCRRT80_DAY14_optimised_01_nolegend,PTA_NOCRRT80_DAY14_optimised_02_nolegend)

file_Cmin80_02 <- c("PTA_CRRT80_DAY14_optimised_nolegend.png","PTA_NOCRRT80_DAY14_optimised_01_nolegend.png","PTA_NOCRRT80_DAY14_optimised_02_nolegend.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_Cmin80_01)) {
  ggsave(file_Cmin80_01[i], plot = plot_Cmin80_01[[i]], dpi = 300, width = 2.7, height = 6)
}

for (i in seq_along(plot_Cmin80_02)) {
  ggsave(file_Cmin80_02[i], plot = plot_Cmin80_02[[i]], dpi = 300, width = 5.5, height = 6)
}
```

#### Plot PTA of 2 targets per day

```{r PTA day 1 of 2 targets CRRT patients, warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/PTAplots_testeddosing")
library(cowplot)
grid_CRRTDAY1 <- plot_grid(PTA_CRRT200_DAY1, PTA_CRRT75_DAY1,nrow = 1, align = "h")
ggsave("combined_CRRTDAY1.png", grid_CRRTDAY1, dpi = 300, width = 26, height = 12)

```

```{r PTA day 1 of 2 targets non-CRRT patients, warning=FALSE}
setwd( "D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/PTAplots_testeddosing")
library(cowplot)
grid_NOCRRTDAY1 <- plot_grid(PTA_NOCRRT200_DAY1, PTA_NOCRRT75_DAY1,nrow = 1, align = "h")
ggsave("combined_NOCRRTDAY1.png", grid_NOCRRTDAY1, dpi = 300, width = 26, height = 12)

```

```{r PTA day 2 of 2 targets CRRT patients, warning=FALSE}
setwd( "D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/PTAplots_testeddosing")
library(cowplot)
grid_CRRTDAY2 <- plot_grid(PTA_CRRT200_DAY2, PTA_CRRT75_DAY2,nrow = 1, align = "h")
ggsave("combined_CRRTDAY2.png", grid_CRRTDAY2, dpi = 300, width = 26, height = 12)

```

```{r PTA day 2 of 2 targets non-CRRT patients, warning=FALSE}
setwd( "D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/PTAplots_testeddosing")
library(cowplot)
grid_NOCRRTDAY2 <- plot_grid(PTA_NOCRRT200_DAY2, PTA_NOCRRT75_DAY2,nrow = 1, align = "h")
ggsave("combined_NOCRRTDAY2.png", grid_NOCRRTDAY2, dpi = 300, width = 26, height = 12)

```

```{r PTA day 7 of 2 targets CRRT patients, warning=FALSE}
setwd( "D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/PTAplots_testeddosing")
library(cowplot)
grid_CRRTDAY7 <- plot_grid(PTA_CRRT200_DAY7, PTA_CRRT75_DAY7,nrow = 1, align = "h")
ggsave("combined_CRRTDAY7.png", grid_CRRTDAY7, dpi = 300, width = 26, height = 12)

```

```{r PTA day 7 of 2 targets non-CRRT patients, warning=FALSE}
setwd( "D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/PTAplots_testeddosing")
library(cowplot)
grid_NOCRRTDAY7 <- plot_grid(PTA_NOCRRT200_DAY7, PTA_NOCRRT75_DAY7,nrow = 1, align = "h")
ggsave("combined_NOCRRTDAY7.png", grid_NOCRRTDAY7, dpi = 300, width = 26, height = 12)

```

```{r PTA day 14 of 2 targets CRRT patients, warning=FALSE}
setwd( "D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/PTAplots_testeddosing")
library(cowplot)
grid_CRRTDAY14 <- plot_grid(PTA_CRRT200_DAY14, PTA_CRRT75_DAY14,nrow = 1, align = "h")
ggsave("combined_CRRTDAY14.png", grid_CRRTDAY14, dpi = 300, width = 26, height = 12)

```

```{r PTA day 14 of 2 targets non-CRRT patients, warning=FALSE}
setwd( "D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/PTAplots_testeddosing")
library(cowplot)
grid_NOCRRTDAY14 <- plot_grid(PTA_NOCRRT200_DAY14, PTA_NOCRRT75_DAY14,nrow = 1, align = "h")
ggsave("combined_NOCRRTDAY14.png", grid_NOCRRTDAY14, dpi = 300, width = 26, height = 12)

```

#### Correlation of DV and fAUC
```{r }
cor(Trough_overall$DV,Trough_overall$fAUC) #good correlation
#[1] 0.9569

lm(Trough_overall$fAUC~Trough_overall$DV)
#Call:
#lm(formula = Trough_overall$fAUC ~ Trough_overall$DV)

#Coefficients:
      #(Intercept)  Trough_overall$DV  
           #133.00              20.97
#R-squared: 0.9158
# Therefore: fAUC = 20.97*DV + 133.00
# If fAUC = 200, DV = 3.2; fAUC = 400, DV = 12.73
```

#### Plots for 3 optimised non-CRRT dosing regimens 190523

##### Firstly, for PTA 200

```{r adjust 4 plots of PTA fAUC200 optimised non-CRRT dosing}

PTA_NOCRRT200_DAY1_optimised_03_nolegend<-PTA_NOCRRT200_DAY1_optimised_03+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 1") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT200_DAY2_optimised_03_nolegend<-PTA_NOCRRT200_DAY2_optimised_03+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 2") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT200_DAY7_optimised_03_nolegend<-PTA_NOCRRT200_DAY7_optimised_03+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 7") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT200_DAY14_optimised_03_nolegend<-PTA_NOCRRT200_DAY14_optimised_03+ theme(
        axis.text = element_text(size = 7),legend.text = element_text(size = 7), legend.title = element_text(size = 9)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 14") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))
          
```

```{r save 4 PTA plots of non-CRRT optimised dosing,warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/PTAplots_optimiseddosing")
# Create a list of plot objects
plot_fAUC200_01 <- list(PTA_NOCRRT200_DAY1_optimised_03_nolegend,PTA_NOCRRT200_DAY2_optimised_03_nolegend,
                        PTA_NOCRRT200_DAY7_optimised_03_nolegend)

# Define the file names
file_fAUC200_01 <- c("PTA_NOCRRT200_DAY1_optimised_03_nolegend.png","PTA_NOCRRT200_DAY2_optimised_03_nolegend.png","PTA_NOCRRT200_DAY7_optimised_03_nolegend.png")


plot_fAUC200_02 <- list(PTA_NOCRRT200_DAY14_optimised_03_nolegend)

file_fAUC200_02 <- c("PTA_NOCRRT200_DAY14_optimised_03_nolegend.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_fAUC200_01)) {
  ggsave(file_fAUC200_01[i], plot = plot_fAUC200_01[[i]], dpi = 300, width = 2.7, height = 6)
}

for (i in seq_along(plot_fAUC200_02)) {
  ggsave(file_fAUC200_02[i], plot = plot_fAUC200_02[[i]], dpi = 300, width = 5.2, height = 6)
}
```

##### Secondly, for Cmin 80

```{r adjust 4 plots of PTA Cmin80 optimised non-CRRT dosing}
PTA_NOCRRT80_DAY1_optimised_03_nolegend<-PTA_NOCRRT80_DAY1_optimised_03+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 1") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY2_optimised_03_nolegend<-PTA_NOCRRT80_DAY2_optimised_03+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 2") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY7_optimised_03_nolegend<-PTA_NOCRRT80_DAY7_optimised_03+guides(color = "none")+ theme(
        axis.text = element_text(size = 7)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 7") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))

PTA_NOCRRT80_DAY14_optimised_03_nolegend<-PTA_NOCRRT80_DAY14_optimised_03+ theme(
        axis.text = element_text(size = 7),legend.text = element_text(size = 7), legend.title = element_text(size = 9)) + theme(axis.title.x = element_blank(), 
                                                           axis.title.y = element_blank()) + ggtitle("DAY 14") +
    theme(plot.title = element_text(hjust = 0.5, size = 12,face="bold")) + scale_x_continuous(limits = c(30, 150), breaks = seq(30, 150, by = 10))
          
```

```{r save 4 toxicity plots of non-CRRT optimised dosing,warning=FALSE}
setwd("D:/Projects/Fluconazole PoPPK KU Leuven/Fluconazol_project/Bootstrap and dosing simulation/BW_Simulations/PTAplots_optimiseddosing")
# Create a list of plot objects
plot_Cmin80_01 <- list(PTA_NOCRRT80_DAY1_optimised_03_nolegend,PTA_NOCRRT80_DAY2_optimised_03_nolegend,
                        PTA_NOCRRT80_DAY7_optimised_03_nolegend)

# Define the file names
file_Cmin80_01 <- c("PTA_NOCRRT80_DAY1_optimised_03_nolegend.png","PTA_NOCRRT80_DAY2_optimised_03_nolegend.png","PTA_NOCRRT80_DAY7_optimised_03_nolegend.png")


plot_Cmin80_02 <- list(PTA_NOCRRT80_DAY14_optimised_03_nolegend)

file_Cmin80_02 <- c("PTA_NOCRRT80_DAY14_optimised_03_nolegend.png")

# Loop through the plot objects and save them as separate files
for (i in seq_along(plot_Cmin80_01)) {
  ggsave(file_Cmin80_01[i], plot = plot_Cmin80_01[[i]], dpi = 300, width = 2.7, height = 6)
}

for (i in seq_along(plot_Cmin80_02)) {
  ggsave(file_Cmin80_02[i], plot = plot_Cmin80_02[[i]], dpi = 300, width = 5.2, height = 6)
}
```